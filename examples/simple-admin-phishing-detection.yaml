socket_path: "/var/run/foff-milter.sock"
default_action: "Accept"

rules:
  # Generic rule: Block emails where From display name contains a domain 
  # but sender is from a completely different domain
  - name: "Block domain spoofing in From header"
    criteria:
      type: "HeaderPattern"
      header: "from"
      pattern: "(?i)\"[^\"]*\\b([a-z0-9.-]+\\.(com|net|org|edu|gov))\\b[^\"]*\"\\s*<[^@]+@(?!.*\\1)[a-z0-9.-]+\\.[a-z]{2,}>"
    action:
      type: "Reject"
      message: "Domain spoofing detected in From header"

  # Generic rule: Block administrative emails with links to unrelated domains
  - name: "Block admin emails with external links"
    criteria:
      type: "And"
      criteria:
        # Administrative subject or sender
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i)(password|account|security|notification|alert|expir|suspend|verify|confirm)"
            - type: "HeaderPattern"
              header: "from"
              pattern: "(?i)(admin|administrator|support|security|noreply|no-reply)@"
        
        # Contains links with email addresses in URL (phishing tactic)
        - type: "HeaderPattern"
          header: "body"
          pattern: "(?i)href=[\"']https?://[^\"']*[#?&][^\"']*[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}"
    action:
      type: "Reject"
      message: "Administrative email with suspicious links blocked"

  # Generic rule: Block emails with DKIM failures claiming to be administrative
  - name: "Block failed DKIM administrative emails"
    criteria:
      type: "And"
      criteria:
        # DKIM authentication failed
        - type: "HeaderPattern"
          header: "authentication-results"
          pattern: "(?i)dkim=fail"
        
        # Claims to be administrative
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i)(password|account|security).{1,30}(expir|notification|alert|suspend)"
            - type: "HeaderPattern"
              header: "from"
              pattern: "(?i)\"[^\"]*\\b[a-z0-9.-]+\\.(com|net|org|edu)\\b[^\"]*\""
    action:
      type: "Reject"
      message: "Failed DKIM authentication on administrative email"
