socket_path: "/var/run/foff-milter.sock"
default_action:
  type: "Accept"

# Statistics configuration
statistics:
  enabled: true
  database_path: "./foff-milter-stats.db"
  flush_interval_seconds: 60

rules:
  # Simple rule: Block emails where From display name looks like a domain
  # This catches most domain spoofing without complex regex
  - name: "Block domain spoofing in From header"
    criteria:
      type: "HeaderPattern"
      header: "from"
      pattern: "(?i)\"[a-z0-9.-]+\\.(com|net|org|edu|gov)\"\\s*<[^@]+@[a-z0-9.-]+\\.[a-z]{2,}>"
    action:
      type: "Reject"
      message: "Potential domain spoofing detected in From header"

  # Simple rule: Block administrative emails with email addresses in URLs
  - name: "Block admin emails with email addresses in links"
    criteria:
      type: "And"
      criteria:
        # Administrative subject or sender
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i)(password|account|security|notification|alert|expir|suspend|verify|confirm)"
            - type: "HeaderPattern"
              header: "from"
              pattern: "(?i)(admin|administrator|support|security|noreply|no-reply)@"
        
        # Contains links with email addresses in URL (strong phishing indicator)
        - type: "HeaderPattern"
          header: "body"
          pattern: "(?i)href=[\"']https?://[^\"']*[#?&][^\"']*[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}"
    action:
      type: "Reject"
      message: "Administrative email with suspicious links blocked"

  # Simple rule: Block DKIM failures with administrative claims
  - name: "Block failed DKIM administrative emails"
    criteria:
      type: "And"
      criteria:
        # DKIM authentication failed
        - type: "HeaderPattern"
          header: "authentication-results"
          pattern: "(?i)dkim=fail"
        
        # Administrative subject
        - type: "SubjectPattern"
          pattern: "(?i)(password|account|security).{1,30}(expir|notification|alert|suspend)"
    action:
      type: "Reject"
      message: "Failed DKIM authentication on administrative email"
