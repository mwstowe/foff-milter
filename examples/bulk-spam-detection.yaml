socket_path: "/var/run/foff-milter.sock"
default_action: "Accept"

rules:
  # Detect bulk spam with undisclosed recipients from free email services
  # This is a very strong spam indicator with minimal false positives
  - name: "Block bulk spam with undisclosed recipients from free email"
    criteria:
      type: "And"
      criteria:
        # Undisclosed recipients pattern
        - type: "HeaderPattern"
          header: "to"
          pattern: "(?i)undisclosed.{0,15}recipients"
        # Free email service domains
        - type: "SenderPattern"
          pattern: ".*@(outlook|gmail|yahoo|hotmail|aol|protonmail|icloud|live|msn)\\.(com|net|org)$"
    action:
      type: "Reject"
      message: "Bulk spam with undisclosed recipients from free email service blocked"

  # Enhanced version with additional spam indicators
  - name: "Advanced bulk spam detection with free email"
    criteria:
      type: "And"
      criteria:
        # Undisclosed recipients
        - type: "HeaderPattern"
          header: "to"
          pattern: "(?i)undisclosed.{0,15}recipients"
        # Free email domains
        - type: "SenderPattern"
          pattern: ".*@(outlook|gmail|yahoo|hotmail|aol|protonmail|icloud|live|msn)\\.(com|net|org)$"
        # Additional spam subject indicators
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i)(congratulations|you.{0,15}(won|winner)|award|prize|lottery|selected|chosen|urgent|act.{0,10}now|limited.{0,10}time)"
            - type: "HeaderPattern"
              header: "from"
              pattern: "(?i)(award|prize|lottery|winner|congratulations|official|department|ministry|bank|foundation|anniversary|promotion|offer)"
    action:
      type: "Reject"
      message: "Advanced bulk spam detection - undisclosed recipients with spam indicators"

  # Tag suspicious bulk emails for analysis (less aggressive)
  - name: "Tag suspicious bulk emails from free services"
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "to"
          pattern: "(?i)undisclosed.{0,15}recipients"
        - type: "SenderPattern"
          pattern: ".*@(outlook|gmail|yahoo|hotmail|aol|protonmail|icloud|live|msn)\\.(com|net|org)$"
    action:
      type: "TagAsSpam"
      header_name: "X-Bulk-Spam-Indicator"
      header_value: "Undisclosed recipients from free email service"

  # Catch random character senders with undisclosed recipients
  - name: "Block random character senders with bulk patterns"
    criteria:
      type: "And"
      criteria:
        # Random character pattern (8+ consecutive lowercase letters)
        - type: "SenderPattern"
          pattern: "^[a-z]{8,}@(outlook|gmail|yahoo|hotmail)\\.(com|net)$"
        - type: "Or"
          criteria:
            # Undisclosed recipients
            - type: "HeaderPattern"
              header: "to"
              pattern: "(?i)undisclosed.{0,15}recipients"
            # Spam subjects
            - type: "SubjectPattern"
              pattern: "(?i)(congratulations|award|prize|winner|lottery|selected)"
    action:
      type: "Reject"
      message: "Random character sender with bulk spam patterns blocked"

  # Comprehensive rule combining multiple indicators
  - name: "Multi-indicator bulk spam detection"
    criteria:
      type: "And"
      criteria:
        # Must be from free email
        - type: "SenderPattern"
          pattern: ".*@(outlook|gmail|yahoo|hotmail|aol|protonmail|icloud|live|msn)\\.(com|net|org)$"
        # Must have bulk characteristics
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "to"
              pattern: "(?i)undisclosed.{0,15}recipients"
            - type: "HeaderPattern"
              header: "bcc"
              pattern: "(?i)undisclosed.{0,15}recipients"
        # Must have spam content indicators
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i)(congratulations|you.{0,15}(won|winner)|award|prize|lottery|selected|chosen|claim|urgent|act.{0,10}now|limited.{0,10}time|exclusive.{0,10}offer)"
            - type: "HeaderPattern"
              header: "from"
              pattern: "(?i)(award|prize|lottery|winner|congratulations|official|department|ministry|bank|foundation|anniversary|promotion|offer|notification|alert)"
            - type: "SenderPattern"
              pattern: "^[a-z]{8,}@"
    action:
      type: "Reject"
      message: "Multi-indicator bulk spam from free email service detected"
