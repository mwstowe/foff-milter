socket_path: "/var/run/foff-milter.sock"
default_action: "Accept"

rules:
  # Detect emails with List-Unsubscribe-Post but no List-Unsubscribe header
  # This is an RFC violation and common spam pattern
  - name: "Block emails with invalid unsubscribe headers"
    criteria:
      type: "InvalidUnsubscribeHeaders"
    action:
      type: "Reject"
      message: "Invalid unsubscribe headers detected (RFC violation)"

  # Alternative: Tag for monitoring instead of blocking
  - name: "Tag emails with invalid unsubscribe headers"
    criteria:
      type: "InvalidUnsubscribeHeaders"
    action:
      type: "TagAsSpam"
      header_name: "X-Invalid-Unsubscribe-Headers"
      header_value: "List-Unsubscribe-Post without List-Unsubscribe"

  # Combined rule: Invalid unsubscribe headers + suspicious content
  - name: "Enhanced spam detection with invalid unsubscribe headers"
    criteria:
      type: "And"
      criteria:
        - type: "InvalidUnsubscribeHeaders"
        - type: "Or"
          criteria:
            # Suspicious subjects
            - type: "SubjectPattern"
              pattern: "(?i)(weight.{0,10}loss|secret.{0,10}revealed|elon.{0,10}musk|congratulations|prize|winner|lottery)"
            # Suspicious senders
            - type: "SenderPattern"
              pattern: ".*@(psybook|suspicious-domain)\\.(info|com)$"
            # Suspicious display names
            - type: "HeaderPattern"
              header: "from"
              pattern: "(?i)(elon.{0,10}musk|weight.{0,10}loss|secret|congratulations|prize|winner)"
    action:
      type: "Reject"
      message: "Spam with invalid unsubscribe headers and suspicious content"

  # Catch fake one-click unsubscribe claims
  - name: "Block fake one-click unsubscribe claims"
    criteria:
      type: "And"
      criteria:
        - type: "InvalidUnsubscribeHeaders"
        - type: "HeaderPattern"
          header: "list-unsubscribe-post"
          pattern: "(?i)list-unsubscribe=one-click"
    action:
      type: "Reject"
      message: "Fake one-click unsubscribe claim without actual unsubscribe mechanism"
