socket_path: "/var/run/foff-milter.sock"
default_action: "Accept"

rules:
  # Block all RAR attachments (strict policy)
  - name: "Block RAR attachments completely"
    criteria:
      type: "AttachmentOnlyEmail"
      max_text_length: 10000      # High limit - we just want to detect RAR presence
      ignore_whitespace: true
      suspicious_types: ["rar"]   # Only check for RAR files
      min_attachment_size: 512    # 512 bytes minimum
      check_disposition: true
    action:
      type: "Reject"
      message: "RAR attachments are not permitted for security reasons"

  # Tag RAR attachments for review (moderate policy)
  - name: "Tag RAR attachments for review"
    criteria:
      type: "AttachmentOnlyEmail"
      max_text_length: 50000      # Very high limit - just detecting presence
      suspicious_types: ["rar"]
      min_attachment_size: 256
      check_disposition: true
    action:
      type: "TagAsSpam"
      header_name: "X-Attachment-RAR"
      header_value: "Contains RAR attachment - review required"

  # Block RAR attachments with minimal text (suspicious pattern)
  - name: "Block suspicious RAR emails with minimal content"
    criteria:
      type: "AttachmentOnlyEmail"
      max_text_length: 100        # Minimal text allowed
      ignore_whitespace: true
      suspicious_types: ["rar"]
      min_attachment_size: 1024   # 1KB minimum
      check_disposition: true
    action:
      type: "Reject"
      message: "RAR attachment with minimal content blocked as suspicious"

  # Block multiple suspicious archive types including RAR
  - name: "Block suspicious archive attachments"
    criteria:
      type: "AttachmentOnlyEmail"
      max_text_length: 200
      ignore_whitespace: true
      suspicious_types: ["rar", "zip", "7z", "tar", "gz"]
      min_attachment_size: 2048   # 2KB minimum
      check_disposition: true
    action:
      type: "TagAsSpam"
      header_name: "X-Suspicious-Archive"
      header_value: "Contains suspicious archive attachment"

  # Advanced: Block RAR from free email services
  - name: "Block RAR attachments from free email services"
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@(gmail|yahoo|hotmail|outlook|aol)\\.(com|net|org)$"
        - type: "AttachmentOnlyEmail"
          max_text_length: 500
          suspicious_types: ["rar"]
          min_attachment_size: 1024
          check_disposition: true
    action:
      type: "Reject"
      message: "RAR attachments from free email services are not allowed"

  # Advanced: Block RAR with suspicious subjects
  - name: "Block RAR with suspicious subjects"
    criteria:
      type: "And"
      criteria:
        - type: "SubjectPattern"
          pattern: "(?i)(invoice|receipt|document|urgent|important|confidential|payment)"
        - type: "AttachmentOnlyEmail"
          max_text_length: 300
          suspicious_types: ["rar"]
          min_attachment_size: 512
          check_disposition: true
    action:
      type: "Reject"
      message: "RAR attachment with suspicious subject blocked"

  # Log all RAR attachments for analysis
  - name: "Log all RAR attachments"
    criteria:
      type: "AttachmentOnlyEmail"
      max_text_length: 100000     # Very high - just logging presence
      suspicious_types: ["rar"]
      min_attachment_size: 100
      check_disposition: true
    action:
      type: "TagAsSpam"
      header_name: "X-Log-RAR-Attachment"
      header_value: "RAR attachment detected for logging"
