# SMTP-Enabled Abuse Reporting Configuration
#
# This configuration demonstrates how to set up SMTP to actually send
# abuse reports to email service providers automatically.
#
# With SMTP configured, the ReportAbuse action will:
# ✅ Actually send emails to abuse@sendgrid.com, abuse@mailchimp.com, etc.
# ✅ Include comprehensive abuse report details
# ✅ Provide immediate notification to service providers
# ✅ Fall back to logging if email sending fails

socket_path: "/var/run/foff-milter.sock"
default_action:
  type: "Accept"

# SMTP Configuration for sending abuse reports
smtp:
  server: "smtp.example.com"           # Your SMTP server
  port: 587                           # STARTTLS port (or 465 for SSL, 25 for plain)
  username: "abuse-reporter@example.com"  # SMTP username
  password: "your-smtp-password"      # SMTP password (consider using environment variables)
  from_email: "abuse-reporter@example.com"  # From address for abuse reports
  from_name: "FOFF Milter Abuse Reporter"   # From name (optional)
  use_tls: true                       # Use STARTTLS (recommended)
  use_ssl: false                      # Use SSL/TLS (mutually exclusive with use_tls)
  timeout_seconds: 30                 # Connection timeout

rules:
  # Detect SendGrid abuse and automatically send report to SendGrid
  - name: "Report SendGrid abuse via email"
    criteria:
      type: "EmailServiceAbuse"
      legitimate_services: ["sendgrid.net", "sendgrid.com"]
      check_reply_to_mismatch: true
      check_brand_impersonation: false
      check_suspicious_subjects: false
    action:
      type: "ReportAbuse"
      service_provider: "sendgrid"
      include_headers: true
      include_body: false
      report_message: "Automated detection of SendGrid infrastructure abuse for phishing campaigns"
      additional_action:
        type: "Reject"
        message: "SendGrid abuse detected, reported, and blocked"

  # Report Mailchimp abuse with email sending
  - name: "Report Mailchimp abuse via email"
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "received"
          pattern: ".*mailchimp\\.com.*"
        - type: "SenderPattern"
          pattern: ".*@(gmail|outlook|yahoo|aol)\\.(com|net)$"
    action:
      type: "ReportAbuse"
      service_provider: "mailchimp"
      include_headers: true
      include_body: false
      report_message: "Free email sender using Mailchimp infrastructure for potential phishing"
      additional_action:
        type: "TagAsSpam"
        header_name: "X-Mailchimp-Abuse-Reported"
        header_value: "YES"

# Example SMTP configurations for different providers:

# Gmail SMTP (requires app password):
# smtp:
#   server: "smtp.gmail.com"
#   port: 587
#   username: "your-email@gmail.com"
#   password: "your-app-password"
#   from_email: "your-email@gmail.com"
#   from_name: "FOFF Milter"
#   use_tls: true
#   use_ssl: false

# Office 365 SMTP:
# smtp:
#   server: "smtp.office365.com"
#   port: 587
#   username: "your-email@yourdomain.com"
#   password: "your-password"
#   from_email: "your-email@yourdomain.com"
#   from_name: "FOFF Milter"
#   use_tls: true
#   use_ssl: false

# Local SMTP server (no authentication):
# smtp:
#   server: "localhost"
#   port: 25
#   from_email: "noreply@yourdomain.com"
#   from_name: "FOFF Milter"
#   use_tls: false
#   use_ssl: false

# What happens when SMTP is configured:
#
# 1. ReportAbuse action triggers
# 2. Abuse report is generated with comprehensive details
# 3. Email is sent directly to abuse@sendgrid.com (or other provider)
# 4. Success/failure is logged
# 5. Additional action is taken (Reject, TagAsSpam, etc.)
#
# Example email sent to abuse@sendgrid.com:
#
# From: FOFF Milter Abuse Reporter <abuse-reporter@example.com>
# To: abuse@sendgrid.com
# Subject: Automated abuse report for phishing email sent through SendGrid infrastructure
#
# Automated detection of SendGrid infrastructure abuse for phishing campaigns
#
# PHISHING EMAIL DETAILS:
# ========================
#
# Sender: bounces+55266851-93ca-marcy=example.com@sendgrid.net
# From Header: terrysmith7987@aol.com
# Recipients: victim@example.com
# Subject: Order Confirmation
#
# EMAIL HEADERS:
# ==============
# Return-Path: <bounces+55266851-93ca-marcy=example.com@sendgrid.net>
# From: Terry S <terrysmith7987@aol.com>
# Reply-To: terrysmith7987@aol.com
# [... all email headers ...]
#
# DETECTION INFORMATION:
# =====================
# This email was automatically detected as phishing/spam abuse of your email infrastructure.
# Please investigate and take appropriate action against the abusing account.
#
# Report generated: 2025-08-18 22:30:00 UTC
# Generated by: FOFF Milter (https://github.com/mwstowe/foff-milter)

# Security Notes:
# - Store SMTP passwords securely (consider environment variables)
# - Use app passwords for Gmail/Office 365
# - Test SMTP configuration before production deployment
# - Monitor SMTP sending limits and quotas
# - Consider using dedicated abuse reporting email account
