name: "Advanced Security"
enabled: true
rules:
  - name: "Attachment-Only Emails"
    enabled: true
    criteria:
      type: "AttachmentOnlyEmail"
    score: 30
    description: "Emails with only attachments and no meaningful content"

  - name: "Empty Content Emails"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "EmptyContentEmail"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "HeaderPattern"
                header: "x-netsuite"
                pattern: ".*"
              - type: "SenderPattern"
                pattern: ".*@.*netsuite\\.com$"
              - type: "HeaderPattern"
                header: "from"
                pattern: ".*@.*netsuite\\.com.*"
              - type: "HeaderPattern"
                header: "list-id"
                pattern: ".*"
              - type: "HeaderPattern"
                header: "mailing-list"
                pattern: ".*"
              - type: "HeaderPattern"
                header: "precedence"
                pattern: "list"
    score: 25
    description: "Emails with no subject or body content, excluding NetSuite business systems and legitimate mailing lists"

  - name: "Image-Only Emails"
    enabled: true
    criteria:
      type: "ImageOnlyEmail"
    score: 35
    description: "Emails containing only images to bypass text filters"

  - name: "HTML Entity Obfuscation"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "BodyPattern"
          pattern: "(?i).*&#[0-9]{2,3};.*&#[0-9]{2,3};.*&#[0-9]{2,3};.*"
        - type: "Or"
          criteria:
            - type: "BodyPattern"
              pattern: "(?i).*&#[0-9]{2,3};.*\\.(com|org|net|info|biz).*"
            - type: "BodyPattern"
              pattern: "(?i).*(click|download|verify|update|secure).*&#[0-9]{2,3};.*"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "HeaderPattern"
                header: "From"
                pattern: ".*@(lovepopcards\\.com|shopify\\.com|.*\\.shopify\\.com|sendgrid\\.net|.*\\.sendgrid\\.net|nytimes\\.com|.*\\.nytimes\\.com|nytdirect@nytimes\\.com).*"
              - type: "BodyPattern"
                pattern: "(?i).*(order.*confirmation|lovepop|pop-up.*card|thank.*you.*for.*placing|the.*new.*york.*times|nytimes\\.com|newsletter).*"
              - type: "HeaderPattern"
                header: "Content-Transfer-Encoding"
                pattern: "quoted-printable"
    score: 30
    description: "Detects HTML entity encoding used to obfuscate malicious domains"

  - name: "Suspicious Attachment Filenames"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i).*(invoice|billing|report|document|statement|receipt).*[A-Z0-9]{10,}.*"
            - type: "HeaderPattern"
              header: "content-disposition"
              pattern: "(?i).*filename.*[A-Z0-9]{10,}\\.(pdf|doc|docx|xls|xlsx|zip).*"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "HeaderPattern"
                header: "x-netsuite"
                pattern: ".*"
              - type: "SenderPattern"
                pattern: ".*@.*netsuite\\.com$"
              - type: "HeaderPattern"
                header: "from"
                pattern: ".*@.*netsuite\\.com.*"
              - type: "SenderPattern"
                pattern: ".*@.*becu\\.org$"
              - type: "HeaderPattern"
                header: "from"
                pattern: ".*@.*becu\\.org.*"
              - type: "And"
                criteria:
                  - type: "HeaderPattern"
                    header: "From"
                    pattern: ".*@.*becu\\.org.*"
                  - type: "HeaderPattern"
                    header: "DKIM-Signature"
                    pattern: ".*d=.*becu\\.org.*"
                  - type: "SubjectPattern"
                    pattern: "(?i).*(estatement|statement.*notification).*"
    score: 35
    description: "Detects suspicious attachment filenames with random characters, excluding NetSuite business systems"

  - name: "Suspicious Encoding Patterns"
    enabled: true
    criteria:
      type: "SubjectPattern"
      pattern: "(?i).*=\\?[a-z0-9-]+\\?[bq]\\?[a-z0-9+/=]{50,}\\?=.*"
    score: 20
    description: "Suspicious base64 or quoted-printable encoding patterns"

  - name: "Compromised Microsoft Account Spam"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*\\.onmicrosoft\\.com$"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=fail"
            - type: "SubjectPattern"
              pattern: "(?i).*(taste|special|uid[0-9]+|restaurant|food|dining).*"
    score: 60
    description: "Compromised Microsoft accounts used for spam with authentication failures"
