name: "Link Analysis"
enabled: true
rules:
  - name: "Suspicious Link Patterns (External Only)"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "PhishingSuspiciousLinks"
          check_url_shorteners: true
          check_suspicious_tlds: false
          check_ip_addresses: false
          allow_sender_domain: true
          allow_email_infrastructure: true
          email_infrastructure_domains:
            - "mailchimp.com"
            - "constantcontact.com"
            - "sendgrid.net"
            - "mailgun.org"
            - "amazonses.com"
            - "outlook.com"
            - "gmail.com"
            - "1800flowersinc.com"
            - "em.1800flowers.com"
            - "salesforce.com"
            - "exacttarget.com"
            - "woot.com"
            - "email.amazonses.com"
            - "bounces.woot.com"
            - "google.com"
            - "microsoft.com"
            - "salesforce.com"
            - "bmsend.com"
            - "benchmarkemail.com"
            - "hubspot.com"
            - "marketo.com"
            - "customer.io"
            - "customeriomail.com"
            - "lovepopcards.com"
            - "lovepop.com"
            - "shopify.com"
            - "iterable.com"
            - "asus.com"
            - "nedm.asus.com"
            - "omicard.asus.com"
            - "neweredm.com"
            - "nytimes.com"
            - "*.nytimes.com"
            - "nl.nytimes.com"
            - "static01.nyt.com"
            - "static.nytimes.com"
            - "sparkpostmail.com"
            - "sparkpost.com"
          suspicious_patterns:
            - "(?i).*(bit\\.ly|tinyurl|t\\.co|goo\\.gl|short\\.link).*"
            - "(?i).*(click.*here|urgent.*link|verify.*account|update.*payment).*"
            - "(?i).*(secure.*login|confirm.*identity|suspended.*account).*"
        - type: "Not"
          criteria:
            type: "And"
            criteria:
              - type: "HeaderPattern"
                header: "Authentication-Results"
                pattern: "dkim=pass.*dmarc=pass"
              - type: "Or"
                criteria:
                  - type: "BodyPattern"
                    pattern: "(?i).*(newsletter|unsubscribe|promotional.*content|marketing.*email).*"
                  - type: "HeaderPattern"
                    header: "List-Unsubscribe"
                    pattern: ".*"
    score: 25
    action:
      type: "TagAsSpam"
      header_name: "X-FOFF-Link"
      header_value: "Suspicious-External-Pattern"
    description: "Detects suspicious patterns in links to external domains (excludes sender domain and email infrastructure)"

  - name: "Links Using IP Addresses"
    enabled: true
    criteria:
      type: "PhishingSuspiciousLinks"
      check_ip_addresses: true
      check_url_shorteners: false
      check_suspicious_tlds: false
      allow_sender_domain: false
      allow_email_infrastructure: false
    score: 50
    action:
      type: "Reject"
      message: "Links using IP addresses are not allowed"
    description: "IP addresses in links are always suspicious regardless of sender"

  - name: "Suspicious TLD Links (External Only)"
    enabled: true
    criteria:
      type: "PhishingSuspiciousLinks"
      check_suspicious_tlds: true
      check_url_shorteners: false
      check_ip_addresses: false
      allow_sender_domain: true
      allow_email_infrastructure: true
      email_infrastructure_domains:
        - "mailchimp.com"
        - "constantcontact.com"
        - "sendgrid.net"
        - "mailgun.org"
        - "amazonses.com"
        - "customer.io"
        - "customeriomail.com"
        - "lovepopcards.com"
        - "lovepop.com"
        - "shopify.com"
        - "iterable.com"
        - "asus.com"
        - "nedm.asus.com"
        - "omicard.asus.com"
        - "neweredm.com"
        - "nytimes.com"
        - "*.nytimes.com"
        - "nl.nytimes.com"
        - "static01.nyt.com"
        - "static.nytimes.com"
        - "sparkpostmail.com"
        - "sparkpost.com"
      suspicious_patterns:
        - "(?i).*\\.(tk|ml|ga|cf|pw|top|click|download)($|/)"
    score: 20
    action:
      type: "TagAsSpam"
      header_name: "X-FOFF-Link"
      header_value: "Suspicious-External-TLD"
    description: "Links to suspicious TLDs from external domains (excludes sender domain and email infrastructure)"

  - name: "Phishing Link Text Patterns"
    enabled: true
    criteria:
      type: "PhishingSuspiciousLinks"
      check_url_shorteners: false
      check_suspicious_tlds: false
      check_ip_addresses: false
      allow_sender_domain: false
      allow_email_infrastructure: false
      suspicious_patterns:
        - "(?i).*(urgent.*action|account.*suspended|verify.*now|click.*immediately).*"
        - "(?i).*(security.*alert|unusual.*activity|confirm.*payment|update.*billing).*"
        - "(?i).*(limited.*time|act.*now|expires.*today|final.*notice).*"
    score: 30
    action:
      type: "TagAsSpam"
      header_name: "X-FOFF-Link"
      header_value: "Phishing-Text-Pattern"
    description: "Detects phishing-style link text regardless of destination domain"
