name: "Refined Brand Impersonation"
enabled: true
rules:
  # Critical: Brand + Auth Failure + Domain Mismatch (300 points)
  - name: "Critical Brand Impersonation"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: "(?i).*(amazon|apple|microsoft|google|facebook|paypal|aarp|walmart|target|netflix|disney|fedex|ups|visa|chase|bank).*"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=fail"
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "spf=fail"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "SenderPattern"
                pattern: ".*@.*(sparkpostmail|sendgrid|mailchimp|constantcontact|amazonses|mailgun|klaviyomail|campaignmonitor|aweber)\\.(com|net|org)$"
              - type: "SenderPattern"
                pattern: ".*@.*(amazon|google|microsoft|apple|netflix|walmart|target|disney|fedex|ups|visa|chase)\\.(com|org)$"
              - type: "HeaderPattern"
                header: "From"
                pattern: "(?i).*(newsletter|digest|marketing|promotional|noreply|no-reply).*"
    score: 300
    description: "Critical: Major brand + authentication failure + domain mismatch"

  # High: Brand + Auth Failure (200 points) - Excluding McDonald's to prevent false positives
  - name: "High Brand Impersonation"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: "(?i).*(amazon|apple|microsoft|google|facebook|paypal|aarp|walmart|target|netflix|disney|fedex|ups|visa|chase|bank).*"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=fail"
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "spf=fail"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "SenderPattern"
                pattern: ".*@.*(sparkpostmail|sendgrid|mailchimp|constantcontact|amazonses|mailgun|klaviyomail|campaignmonitor)\\.(com|net|org)$"
              - type: "HeaderPattern"
                header: "From"
                pattern: "(?i).*(newsletter|digest|marketing|promotional|noreply|no-reply).*"
    score: 200
    description: "High: Major brand + authentication failure"

  # HR Document Sharing Phishing (200 points)
  - name: "HR Document Sharing Phishing"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i).*(hr.*shared|hr.*document|salary.*review|incentive.*overview|payroll.*document).*"
            - type: "BodyPattern"
              pattern: "(?i).*(hr.*shared|salary.*review|incentive.*overview|payroll.*document).*"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(hr|payroll|benefits|workday|adp|bamboohr|docusign|sharepoint|onedrive|dropbox)\\.(com|net|org)$"
    score: 200
    description: "HR document sharing phishing (BEC pattern)"

  # Organization Impersonation (150 points)
  - name: "Organization Impersonation"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "SubjectPattern"
          pattern: "(?i).*\\w+\\.com\\s+(hr|it|admin|support|team).*"
        - type: "BodyPattern"
          pattern: "(?i).*\\w+\\.com\\s+(hr|it|admin|support|team).*"
    score: 150
    description: "Organization impersonation with domain claims"
