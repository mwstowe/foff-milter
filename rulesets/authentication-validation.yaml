name: "Authentication Validation"
enabled: true
rules:
  # Critical Authentication Failure (+100 points)
  - name: "Critical Authentication Failure"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=fail"
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "spf=fail"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "From"
              pattern: "(?i).*(paypal|amazon|microsoft|google|apple|bank).*"
            - type: "SubjectPattern"
              pattern: "(?i).*(urgent|verify|suspended|security|payment).*"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(amazonses|sendgrid|mailchimp|sparkpostmail)\\.(com|net)$"
    score: 100
    description: "Authentication failure for critical brands or urgent content"

  # DKIM Failure Penalty (+30 points)
  - name: "DKIM Failure Penalty"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=fail"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "SenderPattern"
                pattern: ".*@.*(gov|edu|mil)$"
              - type: "SenderPattern"
                pattern: ".*@.*(amazonses|sendgrid|mailchimp|sparkpostmail|adobe|costco)\\.(com|net)$"
              - type: "SenderPattern"
                pattern: ".*@.*(empower|fidelity|vanguard|schwab|merrill|chase|wellsfargo|bankofamerica)\\.(com|org)$"
              - type: "SenderPattern"
                pattern: ".*@.*oxfordclub\\.(com|org)$"
              - type: And
                criteria:
                  - type: SubjectPattern
                    pattern: "(?i).*(invoice|receipt|statement|bill|payment|quote|estimate).*"
                  - type: SenderPattern
                    pattern: ".*@.*(exterminators|contractors|services|business|company)\\.(com|net|org)$"
    score: 30
    description: "DKIM signature validation failure"

  # SPF Failure Penalty (+30 points)
  - name: "SPF Failure Penalty"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "spf=fail"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(gov|edu|mil)$"
    score: 30
    description: "SPF policy validation failure"

  # Domain Mismatch Detection (+75 points)
  - name: "Domain Mismatch Detection"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "From"
          pattern: "(?i).*(company|organization|business|enterprise).*"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "SenderPattern"
                pattern: ".*@.*\\.(com|org|net|edu|gov)$"
              - type: "HeaderPattern"
                header: "Authentication-Results"
                pattern: "dkim=pass.*spf=pass"
    score: 75
    description: "Sender domain mismatch with claimed organization"

  # Suspicious Sender Patterns (+50 points)
  - name: "Suspicious Sender Patterns"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$"
        - type: "SenderPattern"
          pattern: ".*@.*\\.(tk|ml|ga|cf|gq|pl|cn)$"
        - type: "SenderPattern"
          pattern: ".*[0-9]{8,}@.*"
        - type: "SenderPattern"
          pattern: ".*@invalid$"
        - type: "SenderPattern"
          pattern: ".*@.*\\.(icu|top|click|download|loan|win)$"
    score: 50
    description: "Suspicious sender domain or address patterns"

  # Missing Authentication Headers (+40 points)
  - name: "Missing Authentication Headers"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "Not"
          criteria:
            type: "HeaderPattern"
            header: "Authentication-Results"
            pattern: "dkim=.*"
        - type: "Not"
          criteria:
            type: "HeaderPattern"
            header: "Authentication-Results"
            pattern: "spf=.*"
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i).*(urgent|verify|suspended|security|payment).*"
            - type: "HeaderPattern"
              header: "From"
              pattern: "(?i).*(official|support|security|billing).*"
    score: 40
    description: "Missing authentication headers for suspicious content"

  # Forged Sender Headers (+60 points)
  - name: "Forged Sender Headers"
    enabled: true
    criteria:
      type: And
      criteria:
        - type: HeaderPattern
          header: "From"
          pattern: "(?i).*(no.*reply|do.*not.*reply|automated|system).*"
        - type: Or
          criteria:
            - type: SubjectPattern
              pattern: "(?i).*(click.*here.*verify|verify.*account.*now|urgent.*action.*required|immediate.*verification|account.*suspended).*"
            - type: BodyPattern
              pattern: "(?i).*(click.*here.*verify|verify.*account.*immediately|urgent.*action.*required|account.*will.*be.*closed).*"
        - type: Or
          criteria:
            - type: HeaderPattern
              header: "Authentication-Results"
              pattern: "dkim=fail"
            - type: Not
              criteria:
                type: HeaderPattern
                header: "Authentication-Results"
                pattern: "dkim=pass"
    score: 60
    description: "Forged no-reply headers with phishing language and auth failure"

  # Legitimate Authentication Rewards (negative scores)
  - name: "Perfect Authentication"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "spf=pass"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dmarc=pass"
    score: -30
    description: "Perfect authentication (DKIM, SPF, DMARC all pass)"

  # Government and Educational Domains (-50 points)
  - name: "Government Educational Domains"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*\\.(gov|edu|mil)$"
    score: -50
    description: "Government, educational, and military domains"

  # Established Domain Authentication (-20 points)
  - name: "Established Domain Authentication"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
        - type: "Or"
          criteria:
            - type: "SenderPattern"
              pattern: ".*@.*(amazon|microsoft|google|apple|paypal|ebay|walmart|target|bestbuy|homedepot|lowes|macys|nordstrom|costco)\\.(com|org|net)$"
            - type: "SenderPattern"
              pattern: ".*@.*(chase|wellsfargo|bankofamerica|citi|usbank|capitalone|discover|americanexpress)\\.(com|org|net)$"
            - type: "SenderPattern"
              pattern: ".*@.*(fedex|ups|usps|dhl)\\.(com|org|net|gov)$"
            - type: "SenderPattern"
              pattern: ".*@.*(netflix|spotify|hulu|disney|adobe|salesforce|shopify)\\.(com|org|net)$"
            - type: "SenderPattern"
              pattern: ".*@.*(govdelivery|public\\.govdelivery)\\.(com|org|net)$"
            - type: "SenderPattern"
              pattern: ".*@.*\\.(gov|edu|mil)$"
    score: -20
    description: "Known legitimate domains with valid DKIM signatures"

  # Known spam domains
  - name: "Known spam domains"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*sfcondoteam\\.com$"
        - type: "HeaderPattern"
          header: "Return-Path"
          pattern: ".*@.*sfcondoteam\\.com$"
        - type: "SenderPattern"
          pattern: ".*@.*skinviti\\.icu$"
        - type: "HeaderPattern"
          header: "Return-Path"
          pattern: ".*@.*skinviti\\.icu$"
    score: 200
    description: "Known repeat spam domains"

  # Suspicious domains with brand claims
  - name: "Suspicious domains with brand claims"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "Or"
          criteria:
            - type: "SenderPattern"
              pattern: ".*\\.(icu|tk|ml|ga|cf|top|click|download)$"
            - type: "HeaderPattern"
              header: "Return-Path"
              pattern: ".*\\.(icu|tk|ml|ga|cf|top|click|download)$"
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i).*(amazon|apple|microsoft|google|facebook|paypal|aarp|walmart|target|netflix|disney|fedex|ups|visa|chase|bank).*"
            - type: "SenderPattern"
              pattern: "(?i).*(amazon|apple|microsoft|google|facebook|paypal|aarp|walmart|target|netflix|disney|fedex|ups|visa|chase|bank).*"
    score: 120
    description: "Suspicious TLD domains claiming to be major brands"

  # DKIM signature verification failed
  - name: "DKIM signature verification failed"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)dkim=fail.*signature verification failed"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "SenderPattern"
                pattern: ".*@.*(gmail|yahoo|hotmail|outlook|aol|icloud|mcdonalds|netflix|amazon|microsoft|google|apple)\\.(com|net)$"
              - type: "SenderPattern"
                pattern: ".*@.*(amazonses|sendgrid|mailchimp|sparkpostmail|adobe|costco)\\.(com|net)$"
              - type: "SenderPattern"
                pattern: ".*@.*(empower|fidelity|vanguard|schwab|merrill|chase|wellsfargo|bankofamerica)\\.(com|org)$"
              - type: "SenderPattern"
                pattern: ".*@.*oxfordclub\\.(com|org)$"
              - type: And
                criteria:
                  - type: SubjectPattern
                    pattern: "(?i).*(invoice|receipt|statement|bill|payment|quote|estimate).*"
                  - type: SenderPattern
                    pattern: ".*@.*(exterminators|contractors|services|business|company)\\.(com|net|org)$"
              - type: "HeaderPattern"
                header: "Authentication-Results"
                pattern: "(?i)spf=pass"
    score: 15
    description: "DKIM signature verification failed (reduced penalty for major brands)"

  # SPF no designated sender hosts
  - name: "SPF no designated sender hosts"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)spf=none.*no designated sender hosts"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(gov|edu|mil)$"
    score: 10
    description: "SPF policy not configured (excluding government domains)"
