name: "ESP Infrastructure"
enabled: true

rules:
  # Walgreens Pharmacy Infrastructure
  - name: "Walgreens Pharmacy Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*walgreens.*"
    score: -150
    description: "Legitimate pharmacy chain infrastructure"

  # USPS Government Service Infrastructure
  - name: "USPS Government Service Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*usps.*"
    score: -100
    description: "Legitimate government postal service infrastructure"

  # A2 Hosting Infrastructure
  - name: "A2 Hosting Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*a2hosting.*"
    score: -100
    description: "Legitimate hosting company infrastructure"

  # Bearaby Sleep Products Infrastructure
  - name: "Bearaby Sleep Products Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*bearaby.*"
    score: -200
    description: "Legitimate sleep products company infrastructure"

  # Withings Health Device Infrastructure
  - name: "Withings Health Device Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*withings.*"
    score: -100
    description: "Legitimate health device company infrastructure"

  # Mailjet/Sendinblue ESP Infrastructure
  - name: "Mailjet Sendinblue ESP Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*(hb\\.d\\.mailin\\.fr|mailin\\.fr|mailjet|sendinblue|brevo\\.net|sp1-brevo\\.net).*"
    score: -150
    description: "Legitimate ESP infrastructure for business communications"

  # CharmTracker Healthcare EHR Infrastructure
  - name: "CharmTracker Healthcare EHR Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*(charmtracker|mailerehr\\.charmtracker).*"
    score: -200
    description: "Legitimate healthcare EHR system infrastructure"

  # Political Organization Infrastructure
  - name: "Political Organization Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*democrats.*"
    score: -400
    description: "Legitimate political organization infrastructure"

  # Oxford Club Newsletter Infrastructure
  - name: "Oxford Club Newsletter Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*oxford.*"
    score: -120
    description: "Legitimate Oxford Club newsletter infrastructure"

  # Legitimate Cannabis Retailers (-150 points)
  - name: "Legitimate Cannabis Retailers"
    enabled: true
    criteria:
      type: And
      criteria:
        - type: Or
          criteria:
            - type: SenderPattern
              pattern: ".*@.*(pot|cannabis|cbd|dispensary|hemp).*\\.(com|net|org)$"
        - type: FeatureAnalysis
          feature_name: "Authentication Analysis"
          evidence_pattern: "DKIM authentication passed"
    score: -150
    description: "Legitimate cannabis retailers with proper authentication"

  # Major ESP Infrastructure (-100 points)
  - name: "Major ESP Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(amazonses|sendgrid|mailchimp|constantcontact|mailgun|sparkpost|postmark|mandrill|adobe-campaign|akamaiedge)\\.(com|net)$"
    score: -100
    description: "Major email service providers with established reputation"

  # Newsletter Platforms (-75 points)
  - name: "Newsletter Platforms"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(beehiiv|substack|convertkit|aweber|getresponse|activecampaign|drip|klaviyo)\\.(com|net)$"
    score: -75
    description: "Legitimate newsletter and marketing platforms"

  # Marketing ESP Infrastructure (-50 points)
  - name: "Marketing ESP Infrastructure"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(hubspot|salesforce|pardot|marketo|eloqua|mailerlite|campaignmonitor)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "List-Unsubscribe"
          pattern: ".*"
    score: -50
    description: "Marketing automation platforms with proper unsubscribe headers"

  # Government and Educational (-200 points)
  - name: "Government and Educational"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*\\.(gov|mil|edu)$"
    score: -200
    description: "Government and educational institutions"

  # Established Brand Domains (-150 points)
  - name: "Established Brand Domains"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(amazon|google|apple|netflix|mcdonalds|walmart|target)\\.(com|org)$"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*onmicrosoft\\.com$"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=pass"
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "spf=pass"
    score: -150
    description: "Established brands with valid authentication (excluding tenant domains)"

  # Cloud Service Providers (-75 points)
  - name: "Cloud Service Providers"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(amazonaws|googlecloud|azure|digitalocean|linode|vultr)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
    score: -75
    description: "Cloud service providers with DKIM authentication"

  # Financial Services Infrastructure (-100 points)
  - name: "Financial Services Infrastructure"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(paypal|stripe|square|venmo|zelle|chase|bankofamerica|wellsfargo)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dmarc=pass"
    score: -100
    description: "Financial services with strong authentication"

  # E-commerce Platforms (-75 points)
  - name: "E-commerce Platforms"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(shopify|woocommerce|magento|bigcommerce|squarespace|etsy)\\.(com|net)$"
    score: -75
    description: "Legitimate e-commerce platform infrastructure"

  # Social Media Platforms (-50 points)
  - name: "Social Media Platforms"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(facebook|twitter|linkedin|instagram|youtube|tiktok|pinterest)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "spf=pass"
    score: -50
    description: "Social media platform notifications with SPF validation"

  # Collaboration Tools (-50 points)
  - name: "Collaboration Tools"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(slack|teams|zoom|webex|gotomeeting|dropbox|box|googledrive)\\.(com|net)$"
    score: -50
    description: "Business collaboration and file sharing services"

  # CRM and Business Tools (-50 points)
  - name: "CRM and Business Tools"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(salesforce|hubspot|zendesk|freshdesk|intercom|drift|calendly)\\.(com|net)$"
    score: -50
    description: "Customer relationship management and business tools"

  # Business System Fast Path
  - name: "Business System Fast Path"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "HeaderPattern"
          header: "x-netsuite"
          pattern: ".*"
        - type: "SenderPattern"
          pattern: ".*@.*(netsuite\\.com|oracleemaildelivery\\.com)$"
        - type: "SenderPattern"
          pattern: ".*@.*salesforce\\.com$"
        - type: "SenderPattern"
          pattern: ".*@.*quickbooks\\.com$"
        - type: "HeaderPattern"
          header: "X-Mailer"
          pattern: ".*NetSuite.*"
    score: -50
    description: "Fast path for legitimate business systems like NetSuite, Salesforce, QuickBooks"

  # Trusted Domain Fast Path
  - name: "Trusted Domain Fast Path"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@(amazon\\.com|microsoft\\.com|apple\\.com|google\\.com|paypal\\.com|ebay\\.com|linkedin\\.com|twitter\\.com|facebook\\.com)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
    score: -75
    description: "Trusted major domains with valid authentication"

  # Disney Store
  - name: "Disney Store"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(disney|disneystore)\\.(com|net)$"
    score: -150
    description: "Disney Store legitimate retailer"

  # Netatmo IoT Devices
  - name: "Netatmo IoT Devices"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*netatmo\\.(com|net)$"
        - type: "SenderPattern"
          pattern: ".*@netatmo\\.com$"
        - type: "HeaderPattern"
          header: "From"
          pattern: ".*netatmo.*"
    score: -200
    description: "Netatmo legitimate IoT device notifications"

  # Veterinary and Pet Services
  - name: "Veterinary and Pet Services"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "HeaderPattern"
          header: "From"
          pattern: ".*@.*\\.vetcove\\.com.*"
        - type: "HeaderPattern"
          header: "DKIM-Signature"
          pattern: ".*d=.*\\.vetcove\\.com.*"
        - type: "BodyPattern"
          pattern: "(?i).*(veterinary|pet.*hospital|animal.*clinic|veterinarian)"
        - type: "SubjectPattern"
          pattern: "(?i).*(appointment.*reminder|vaccination.*due|pet.*health)"
    score: -200
    description: "Whitelist legitimate veterinary and pet service communications"

  # Retail and Commerce Brands
  - name: "Retail and Commerce Brands"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(duluthtrading|levi|michaels|kingarthurbaking|eyebuydirect|fiestatableware|kitchenaid|whirlpool|arbys|condenast|nationalgeographic)\\.(com|net)$"
    score: -150
    description: "Legitimate retail and commerce brand communications"

  # Brand Domain Validation
  - name: "Brand Domain Validation"
    enabled: true
    criteria:
      type: "SenderDomain"
      domains: ["levi.com", "duluthtrading.com", "michaels.com", "kingarthurbaking.com", "eyebuydirect.com"]
    score: -300
    description: "Legitimate brand emails from verified domains"

  # Known legitimate mailing service providers
  - name: "Known legitimate mailing service providers"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "List-Unsubscribe"
          pattern: ".*"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
        - type: "HeaderPattern"
          header: "From"
          pattern: "(?i).*(newsletter|marketing|promo|updates|news).*"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "BodyPattern"
                pattern: "(?i).*<img.*src.*http.*"
              - type: "BodyPattern"
                pattern: "^.{0,200}$"
    score: -100
    description: "Legitimate mailing services with proper authentication, unsubscribe, and substantial content"

  # Enhanced Marketing ESP Infrastructure
  - name: "Enhanced Marketing ESP Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(klaviyomail|campaignmonitor|aweber|getresponse|convertkit|activecampaign|drip|mailerlite|flodesk)\\.(com|net|email)$"
    score: -60
    description: "Enhanced legitimate marketing email service providers"

  # Major Technology Companies
  - name: "Major Technology Companies"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(asus|nedm\\.asus|meta|email\\.meta|do_not_reply@email\\.meta|capitalone|capitaloneshopping|accounts\\.capitaloneshopping|hello@accounts\\.capitaloneshopping)\\.(com|net|org)$"
    score: -100
    description: "Legitimate major technology and financial companies"

  # Authenticated Commercial Content Adjustment
  - name: "Authenticated Commercial Content Adjustment"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)(dmarc=pass|spf=pass)"
        - type: "HeaderPattern"
          header: "List-Unsubscribe"
          pattern: ".*"
        - type: "BodyPattern"
          pattern: "(?i)(sale|discount|offer|deal|promotion|limited.*time)"
        - type: "SenderPattern"
          pattern: ".*@.*(amazon|ebay|etsy|shopify|target|walmart|bestbuy|homedepot|lowes|macys|nordstrom|kohls|disney|kickstarter|eyebuydirect|torrid)\\.(com|net|org)$"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(yournconcierge|cardiovascular|internetdisaster|familyandfriendsllc|ybokjraxqz|solecomfort)\\.(com|net|org|top|lat)$"
    score: -30
    description: "Reduce commercial scoring ONLY for authenticated emails from known legitimate retailers"

  # Cultural and Educational Institutions
  - name: "Cultural and Educational Institutions"
    enabled: true
    criteria:
      type: "Or"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@nordicmuseum\\.org$"
        - type: "HeaderPattern"
          header: "From"
          pattern: ".*@nordicmuseum\\.org.*"
        - type: "SenderPattern"
          pattern: ".*@.*(museum|cultural|arts|library|university|college)\\.(org|edu)$"
    score: -200
    description: "Cultural institutions, museums, and educational organizations"
