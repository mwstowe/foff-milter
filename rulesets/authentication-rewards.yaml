name: "Authentication Rewards"
enabled: true
rules:
  # Authentication failure penalties
  - name: "DKIM signature verification failed"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)dkim=fail.*signature verification failed"
        - type: "Not"
          criteria:
            type: "Or"
            criteria:
              - type: "SenderPattern"
                pattern: ".*@.*(gmail|yahoo|hotmail|outlook|aol|icloud|mcdonalds|netflix|amazon|microsoft|google|apple)\\.(com|net)$"
              - type: "HeaderPattern"
                header: "Authentication-Results"
                pattern: "(?i)spf=pass"
    score: 15
    description: "DKIM signature verification failed (reduced penalty for major brands)"

  - name: "SPF no designated sender hosts"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Received-SPF"
          pattern: "(?i)none.*does not designate permitted sender hosts"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(gmail|yahoo|hotmail|outlook|aol|icloud)\\.(com|net)$"
    score: 25
    description: "SPF record indicates no designated sender hosts for non-free email"

  # Enhanced DKIM verification using unified API
  - name: "Multiple DKIM signatures with alignment"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "DkimStatus"
          required_status: "pass"
          min_signatures: 2
          check_alignment: true
        - type: "DkimAlignment"
          require_alignment: false  # Reward aligned domains
    score: -30
    description: "Multiple DKIM signatures with proper domain alignment"

  - name: "DKIM domain misalignment penalty"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "DkimStatus"
          required_status: "pass"
        - type: "DkimAlignment"
          require_alignment: true  # Penalize misaligned domains
    score: 25
    description: "DKIM signature present but domain misaligned"

  # Strong authentication rewards
  - name: "Triple Authentication Pass"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)dmarc=pass"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)spf=pass"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)dkim=pass"
    score: -50
    description: "Strong authentication with DMARC, SPF, and DKIM all passing"

  # Reduce authentication bonus for suspicious image-only healthcare content
  - name: "Authentication Bonus Reduction for Suspicious Content"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)dkim=pass"
        - type: "Or"
          criteria:
            - type: "SubjectPattern"
              pattern: "(?i).*(medicare|health.*plan|insurance.*plan|aep|enrollment)"
            - type: "BodyPattern"
              pattern: "(?i).*(medicare|health.*plan|insurance.*plan|ehealth|advantage.*plan)"
        - type: "BodyPattern"
          pattern: "(?i).*<img.*src.*"
    score: 15
    description: "Reduce authentication trust for image-only healthcare/Medicare content"

  - name: "DMARC and SPF Pass"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)dmarc=pass"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)spf=pass"
        - type: "Not"
          criteria:
            type: "HeaderPattern"
            header: "Authentication-Results"
            pattern: "(?i)dkim=pass"
    score: -35
    description: "Good authentication with DMARC and SPF passing"

  - name: "Basic SPF Pass"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)spf=pass"
        - type: "Not"
          criteria:
            type: "HeaderPattern"
            header: "Authentication-Results"
            pattern: "(?i)dmarc=pass"
    score: -15
    description: "Basic authentication with SPF passing"

  # CAN-SPAM compliance rewards
  - name: "Full CAN-SPAM Compliance"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "List-Unsubscribe"
          pattern: ".*"
        - type: "BodyPattern"
          pattern: "(?i)(unsubscribe|opt.{0,5}out)"
        - type: "BodyPattern"
          pattern: "(?i)\\d+.*\\w+.*(street|ave|road|blvd|drive|way|lane|court|place|suite|floor).*\\w+.*\\d{5}"
    score: -40
    description: "Full CAN-SPAM compliance with unsubscribe header, link, and physical address"

  - name: "Unsubscribe Header Present"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "List-Unsubscribe"
          pattern: ".*"
        - type: "BodyPattern"
          pattern: "(?i)(unsubscribe|opt.{0,5}out)"
        - type: "Not"
          criteria:
            type: "UnsubscribeLinkValidation"
            timeout_seconds: 3
            check_dns: true
            check_http: false
    score: -25
    description: "Proper unsubscribe mechanism with validated header and body link"

  - name: "Basic Unsubscribe Link"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "BodyPattern"
          pattern: "(?i)(unsubscribe|opt.{0,5}out)"
        - type: "Not"
          criteria:
            type: "HeaderPattern"
            header: "List-Unsubscribe"
            pattern: ".*"
    score: -10
    description: "Basic unsubscribe link present in body"

  # Domain reputation rewards
  - name: "Established Domain Authentication"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)(spf=pass|dkim=pass)"
        - type: "SenderDomain"
          domains: [
            "amazon.com", "walmart.com", "target.com", "bestbuy.com", "homedepot.com",
            "lowes.com", "costco.com", "macys.com", "nordstrom.com", "kohls.com",
            "jcpenney.com", "sears.com", "overstock.com", "wayfair.com", "etsy.com",
            "ebay.com", "paypal.com", "stripe.com", "square.com", "shopify.com",
            "mailchimp.com", "constantcontact.com", "sendgrid.com", "mailgun.com"
          ]
    score: -30
    description: "Authenticated email from established business domain"

  # Professional email service rewards
  - name: "Legitimate Email Service Provider"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "(?i)spf=pass"
        - type: "SenderPattern"
          pattern: ".*@.*(mailchimp|constantcontact|sendgrid|mailgun|campaignmonitor|aweber|getresponse|convertkit|activecampaign|aliexpress|alibaba|shopify|bigcommerce|woocommerce|magento)\\.(com|net|org).*"
    score: -25
    description: "Email from legitimate email service provider with authentication"

  # Major e-commerce platform authentication
  - name: "Major E-commerce Platform Authentication"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "DKIM-Signature"
          pattern: "(?i)d=(deals\\.)?(aliexpress|alibaba|shopify|bigcommerce|woocommerce|magento)\\.(com|net|org)"
        - type: "SenderPattern"
          pattern: ".*@.*(aliexpress|alibaba|shopify|bigcommerce|woocommerce|magento)\\.(com|net|org).*"
    score: -40
    description: "Authenticated email from major e-commerce platform"

  # ARC-validated forwarded emails (handles Gmail forwarding scenarios)
  - name: "ARC Validated Forwarded Email"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "ARC-Seal"
          pattern: "cv=pass"
        - type: "HeaderPattern"
          header: "Return-Path"
          pattern: ".*@gmail\\.com"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=pass.*nytimes\\.com"
            - type: "HeaderPattern"
              header: "DKIM-Signature"
              pattern: "d=nytimes\\.com"
    score: -200
    description: "ARC-validated forwarded email from legitimate news organization"

  # Authenticated email encoding adjustment - ONLY for legitimate domains
  - name: "Authenticated Email Encoding Adjustment"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
        - type: "SenderPattern"
          pattern: ".*@.*(plex|netflix|disney|costco|amazon|google|microsoft|apple|paypal|ebay|etsy|shopify|mailchimp|constantcontact|sendgrid|kickstarter|eyebuydirect|sparkpostmail|gmail|torrid|nytimes)\\.(tv|com|net|org)$"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*(yournconcierge|cardiovascular|internetdisaster|familyandfriendsllc|ybokjraxqz|solecomfort|airfilterllc|skytronreveal|magazine1|dailydials19)\\.(com|net|org|top|lat|co\\.uk)$"
    score: -100
    description: "Reduce encoding penalties ONLY for authenticated emails from known legitimate domains"
