name: "ESP Infrastructure"
enabled: true
description: "Consolidated Email Service Provider infrastructure recognition and whitelisting"

rules:
  # Major ESP Infrastructure (-100 points)
  - name: "Major ESP Infrastructure"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(amazonses|sendgrid|mailchimp|constantcontact|mailgun|sparkpost|postmark|mandrill)\\.(com|net)$"
    score: -100
    description: "Major email service providers with established reputation"

  # Newsletter Platforms (-75 points)
  - name: "Newsletter Platforms"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(beehiiv|substack|convertkit|aweber|getresponse|activecampaign|drip|klaviyo)\\.(com|net)$"
    score: -75
    description: "Legitimate newsletter and marketing platforms"

  # Marketing ESP Infrastructure (-50 points)
  - name: "Marketing ESP Infrastructure"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(hubspot|salesforce|pardot|marketo|eloqua|mailerlite|campaignmonitor)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "List-Unsubscribe"
          pattern: ".*"
    score: -50
    description: "Marketing automation platforms with proper unsubscribe headers"

  # Government and Educational (-200 points)
  - name: "Government and Educational"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*\\.(gov|mil|edu)$"
    score: -200
    description: "Government and educational institutions"

  # Established Brand Domains (-150 points)
  - name: "Established Brand Domains"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(amazon|google|apple|netflix|mcdonalds|walmart|target)\\.(com|org)$"
        - type: "Not"
          criteria:
            type: "SenderPattern"
            pattern: ".*@.*onmicrosoft\\.com$"
        - type: "Or"
          criteria:
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "dkim=pass"
            - type: "HeaderPattern"
              header: "Authentication-Results"
              pattern: "spf=pass"
    score: -150
    description: "Established brands with valid authentication (excluding tenant domains)"

  # Cloud Service Providers (-75 points)
  - name: "Cloud Service Providers"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(amazonaws|googlecloud|azure|digitalocean|linode|vultr)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dkim=pass"
    score: -75
    description: "Cloud service providers with DKIM authentication"

  # Financial Services Infrastructure (-100 points)
  - name: "Financial Services Infrastructure"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(paypal|stripe|square|venmo|zelle|chase|bankofamerica|wellsfargo)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "dmarc=pass"
    score: -100
    description: "Financial services with strong authentication"

  # E-commerce Platforms (-75 points)
  - name: "E-commerce Platforms"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(shopify|woocommerce|magento|bigcommerce|squarespace|etsy)\\.(com|net)$"
    score: -75
    description: "Legitimate e-commerce platform infrastructure"

  # Social Media Platforms (-50 points)
  - name: "Social Media Platforms"
    enabled: true
    criteria:
      type: "And"
      criteria:
        - type: "SenderPattern"
          pattern: ".*@.*(facebook|twitter|linkedin|instagram|youtube|tiktok|pinterest)\\.(com|net)$"
        - type: "HeaderPattern"
          header: "Authentication-Results"
          pattern: "spf=pass"
    score: -50
    description: "Social media platform notifications with SPF validation"

  # Collaboration Tools (-50 points)
  - name: "Collaboration Tools"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(slack|teams|zoom|webex|gotomeeting|dropbox|box|googledrive)\\.(com|net)$"
    score: -50
    description: "Business collaboration and file sharing services"

  # CRM and Business Tools (-50 points)
  - name: "CRM and Business Tools"
    enabled: true
    criteria:
      type: "SenderPattern"
      pattern: ".*@.*(salesforce|hubspot|zendesk|freshdesk|intercom|drift|calendly)\\.(com|net)$"
    score: -50
    description: "Customer relationship management and business tools"
