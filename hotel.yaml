socket_path: /var/run/foff-milter.sock
default_action:
  type: Accept
statistics:
  enabled: true
  database_path: /var/lib/foff-milter/stats.db
  flush_interval_seconds: 60
rules:
- name: Whitelist Google Groups mailing lists
  criteria:
    type: Or
    criteria:
    - type: HeaderPattern
      header: list-id
      pattern: .*\.googlegroups\.com
    - type: HeaderPattern
      header: x-google-group-id
      pattern: \d+
    - type: HeaderPattern
      header: received
      pattern: .*groups\.google\.com.*
  action:
    type: Accept
- name: Whitelist trusted Gmail sender
  criteria:
    type: SenderPattern
    pattern: trusted\.user@gmail\.com
  action:
    type: Accept
- name: Reject SparkPost emails to internal queue
  criteria:
    type: And
    criteria:
    - type: MailerPattern
      pattern: .*\.sparkpostmail\.com
    - type: RecipientPattern
      pattern: queue@yourdomain\.com
  action:
    type: Reject
    message: SparkPost blocked for internal queue
- name: Tag SEO and marketing spam
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(why.*pay.*for.*ads|pay.*for.*results|seo.*service|web.*ranking|search.*engine.*optimization|increase.*website.*traffic|boost.*your.*ranking|get.*more.*leads|digital.*marketing.*service|website.*promotion|online.*marketing|web.*development.*service|rank.*higher.*on.*google|improve.*your.*seo|guaranteed.*results|first.*page.*google).*
      - type: And
        criteria:
        - type: SenderPattern
          pattern: .*@.*(seo|webrank|marketing|digitalmarketing|webdev|webdesign|onlinemarketing|searchengine|webpromo|leadgen|webservice).*\.(com|net|org)$
        - type: Not
          criteria:
            type: SenderPattern
            pattern: .*@.*(lyftmail|ubermail|amazonses|mailchimp|constantcontact|sendgrid|mailgun|sparkpost|mandrill|postmark|salesforce|hubspot|marketo|pardot|eloqua|responsys|exacttarget|campaignmonitor|aweber|getresponse|convertkit|activecampaign|klaviyo|sendinblue|mailjet|pepipost|socketlabs|elastic|postmark|sendpulse|moosend|benchmark|emma|vertical|icontact|mad|streamsend|campaigner|directmail|mailerlite|omnisend|drip|autopilot|intercom|drift|zendesk|freshworks|zoho).*\.(com|net|org)$
      - type: HeaderPattern
        header: from
        pattern: (?i).*(seo.*specialist|marketing.*expert|web.*developer|digital.*marketer|lead.*generation|website.*promotion).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Reject Chinese service domains with spam content (any language)
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@(service|mail|smtp|email|send|bulk|mass|marketing).*\.(cn|com\.cn)$
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(email.*list|mailing.*list|100%.*valid|any.*country|bulk.*email|mass.*email|marketing.*list|lead.*generation|database.*email|verified.*email|fresh.*email|targeted.*email|business.*email|consumer.*email).*
      - type: And
        criteria:
        - type: HeaderPattern
          header: from
          pattern: .*@gmail\.com$
        - type: SenderPattern
          pattern: .*@.*\.(cn|com\.cn)$
  action:
    type: Reject
    message: Chinese service domain spam rejected
- name: Reject Chinese service domains (.cn) sending Japanese content
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@service\.[^.]+\.cn$
      - type: SenderPattern
        pattern: .*@service\..*\.cn$
    - type: SubjectContainsLanguage
      language: japanese
  action:
    type: Reject
    message: Chinese service with Japanese content blocked
- name: Reject service.*.com domains sending Japanese content
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: service\..*\.com
    - type: SubjectContainsLanguage
      language: japanese
  action:
    type: Reject
    message: Spam rejected
- name: Tag emails with Google API unsubscribe links
  criteria:
    type: UnsubscribeLinkPattern
    pattern: .*\.googleapis\.com.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Reject emails from .ru.com domains
  criteria:
    type: SenderPattern
    pattern: .*\.ru\.com
  action:
    type: Reject
    message: Spam rejected
- name: Tag SharePoint impersonation attacks
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@sharepointonline\.com$
      - type: HeaderPattern
        header: from
        pattern: (?i)sharepoint
    - type: Or
      criteria:
      - type: Not
        criteria:
          type: HeaderPattern
          header: dkim-signature
          pattern: d=(microsoft|sharepointonline|outlook|office365)\.com
      - type: HeaderPattern
        header: received
        pattern: from \[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\]
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(wire.*remittance|wire.*transfer|payment.*confirmation|invoice.*shared|document.*shared|file.*shared|urgent.*document|confidential.*document).*
        - type: HeaderPattern
          header: received
          pattern: .*\.(openredirect|redirect|phishing|malware)\.
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious Microsoft onmicrosoft.com domain abuse
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@.*\.onmicrosoft\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: HeaderPattern
        header: dkim-signature
        pattern: d=.*gappssmtp\.com
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(dailydials|entrprise|enterprise|random|test|temp|spam).*\.onmicrosoft\.com$
        - type: SenderPattern
          pattern: ^[a-z0-9]{8,}@.*\.onmicrosoft\.com$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag fake Microsoft and Microsoft services abuse
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: reply-to
        pattern: .*\.onmicrosoft\.com
      - type: HeaderPattern
        header: from
        pattern: .*\.onmicrosoft\.com
      - type: SenderPattern
        pattern: .*@.*\.onmicrosoft\.com$
      - type: SenderPattern
        pattern: .*@(sharepointonline|outlook|live|hotmail|microsoft|office365)\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: dkim-signature
        pattern: d=.*onmicrosoft.*\.com
      - type: HeaderPattern
        header: received
        pattern: from \[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\]
      - type: SenderPattern
        pattern: .*@(enterprise|entrprise|company|business|corp).*\.onmicrosoft\.com$
    - type: Not
      criteria:
        type: HeaderPattern
        header: dkim-signature
        pattern: d=(microsoft|sharepointonline|outlook|office365|onmicrosoft)\.com
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(harbor.*freight|customer.*dispatch).*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(sign.*here|document.*sign|review.*document|sharepoint).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(sharepoint|document|signature|no-reply).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag legitimate domains from external IPs without proper authentication
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@(microsoft|google|apple|amazon|adobe|docusign|dropbox|slack|zoom|salesforce|sharepointonline|outlook|gmail|paypal|ebay|netflix|spotify|office365)\.com$
    - type: HeaderPattern
      header: received
      pattern: from \[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\]
    - type: Not
      criteria:
        type: HeaderPattern
        header: dkim-signature
        pattern: d=(microsoft|google|apple|amazon|adobe|docusign|dropbox|slack|zoom|salesforce|sharepointonline|outlook|gmail|paypal|ebay|netflix|spotify|office365)\.com
    - type: Not
      criteria:
        type: HeaderPattern
        header: received
        pattern: (?i).*(forwarded|relay|gateway|mimecast|proofpoint).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails from aizen.ink domains
  criteria:
    type: SenderPattern
    pattern: .*\.aizen\.ink
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails from .za.com domains
  criteria:
    type: SenderPattern
    pattern: .*\.za\.com
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails from .sa.com domains
  criteria:
    type: SenderPattern
    pattern: .*\.sa\.com
  action:
    type: Reject
    message: Fuck right off
- name: Tag emails with invalid unsubscribe links (DNS only)
  criteria:
    type: And
    criteria:
    - type: UnsubscribeLinkValidation
      timeout_seconds: 10
      check_dns: true
      check_http: false
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@.*(iheart|spotify|pandora|netflix|hulu|disney|paramount|hbo|showtime|starz|peacock|appletv|amazon|youtube|twitch|tiktok|instagram|facebook|twitter|linkedin)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(cnn|fox|nbc|abc|cbs|npr|pbs|reuters|ap|bloomberg|wsj|nytimes|washingtonpost|usatoday|time|newsweek|fortune|forbes)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(podcast|podcastone|stitcher|castbox|overcast|pocketcasts|radiolab|thisamericanlife|serialpodcast)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(amazon|walmart|target|bestbuy|homedepot|lowes|costco|macys|nordstrom|wayfair|overstock|ebay|etsy|shopify)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(mailchimp|constantcontact|sendgrid|mailgun|customer\.io|intercom|hubspot|salesforce)\.(com|net)$
        - type: HeaderPattern
          header: list-id
          pattern: <.*\.(com|org|net|edu|gov)>$
        - type: HeaderPattern
          header: x-google-group-id
          pattern: \d+
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Microsoft Reply Spam
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: Auto-Submitted
      pattern: auto-replied
    - type: HeaderPattern
      header: X-MS-PublicTrafficType
      pattern: .*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails from click tracking domains
  criteria:
    type: Or
    criteria:
    - type: SenderPattern
      pattern: .*@.*\.click$
    - type: HeaderPattern
      header: received
      pattern: .*\.click
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag sender spoofing attempts
  criteria:
    type: PhishingSenderSpoofing
    trusted_domains:
    - baddomain.com
    - paypal.com
    - amazon.com
    - microsoft.com
    - google.com
    - apple.com
    - netflix.com
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag comprehensive phishing attempts
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: And
        criteria:
        - type: SubjectPattern
          pattern: (?i)(expire|suspend|verify|update|confirm|urgent|immediate|security|alert|warning)
        - type: Or
          criteria:
          - type: PhishingSenderSpoofing
            trusted_domains:
            - baddomain.com
            - paypal.com
            - amazon.com
            - microsoft.com
          - type: PhishingDomainMismatch
            allow_subdomains: true
      - type: And
        criteria:
        - type: PhishingSuspiciousLinks
          check_url_shorteners: true
          check_suspicious_tlds: true
          check_ip_addresses: true
        - type: SubjectPattern
          pattern: (?i)(click|release|inbox|email|message|account)
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(amazon|amazonses|woot|audible|twitch|imdb|goodreads|zappos|shopbop|eastdane|myhabit|diapers|soap|beautybar|casa|yoox)\.(com|net)$
        - type: HeaderPattern
          header: received
          pattern: .*amazonses\.com.*
        - type: HeaderPattern
          header: feedback-id
          pattern: .*AmazonSES.*
        - type: HeaderPattern
          header: x-mailer
          pattern: .*Mailchimp.*
        - type: HeaderPattern
          header: received
          pattern: .*(mailchimp|mcsv\.net|rsgsv\.net).*
        - type: HeaderPattern
          header: feedback-id
          pattern: .*:mc$
        - type: HeaderPattern
          header: received
          pattern: .*(constantcontact|sendgrid|mailgun|customeriomail)\.(com|net).*
        - type: HeaderPattern
          header: x-google-group-id
          pattern: \d+
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid phishing redirects
  criteria:
    type: PhishingLinkRedirection
    max_redirects: 5
    timeout_seconds: 10
    check_final_destination: true
    suspicious_redirect_patterns:
    - .*\.sslip\.io.*
    - .*wordpress-.*
    - .*\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid with free email reply-to
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: MailerPattern
        pattern: .*sendgrid\.net.*
      - type: HeaderPattern
        header: return-path
        pattern: .*@sendgrid\.net$
      - type: HeaderPattern
        header: received
        pattern: .*sendgrid\.net.*
    - type: Or
      criteria:
      - type: PhishingFreeEmailReplyTo
        free_email_domains:
        - outlook.com
        - gmail.com
        - yahoo.com
        - hotmail.com
        - aol.com
        allow_same_domain: false
      - type: SenderPattern
        pattern: .*@(outlook|gmail|yahoo|hotmail|aol)\.(com|net)$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SubjectPattern
        pattern: (?i)^(welcome|hello|hi|greetings|notification|alert|update|message|important|urgent)$
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: .*[a-z]+\d{5,}@(gmail|outlook|yahoo|hotmail)\.(com|net)$
        - type: HeaderPattern
          header: reply-to
          pattern: .*[a-z]+\d{5,}@(gmail|outlook|yahoo|hotmail)\.(com|net)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag image-only emails
  criteria:
    type: ImageOnlyEmail
    max_text_length: 30
    ignore_whitespace: true
    check_attachments: false
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag free email reply-to phishing (conservative)
  criteria:
    type: And
    criteria:
    - type: PhishingFreeEmailReplyTo
      free_email_domains:
      - gmail.com
      - yahoo.com
      - hotmail.com
      - outlook.com
      - aol.com
      - protonmail.com
      allow_same_domain: false
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(google|googlemail|gmail)\.com$
        - type: HeaderPattern
          header: list-id
          pattern: <.*\.(com|org|net|edu|gov)>$
        - type: HeaderPattern
          header: x-google-group-id
          pattern: \d+
        - type: SenderPattern
          pattern: .*@(microsoft|outlook|live|hotmail|msn)\.com$
        - type: SenderPattern
          pattern: .*@(apple|icloud|me)\.com$
        - type: SenderPattern
          pattern: .*@(dropbox|slack|zoom|spotify|netflix)\.com$
        - type: HeaderPattern
          header: auto-submitted
          pattern: auto-generated
        - type: Or
          criteria:
          - type: SenderPattern
            pattern: .*calendar.*@.*
          - type: SenderPattern
            pattern: .*notification.*@.*
          - type: SubjectPattern
            pattern: (?i).*(notification|calendar|reminder|meeting|appointment).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails with invalid reply-to DNS resolution (conservative)
  criteria:
    type: And
    criteria:
    - type: ReplyToValidation
      timeout_seconds: 10
      check_mx_record: false
    - type: Or
      criteria:
      - type: HeaderPattern
        header: reply-to
        pattern: .*@(gmail|outlook|yahoo|hotmail|aol|protonmail|zoho)\.(com|net|org)$
      - type: HeaderPattern
        header: reply-to
        pattern: .*\.(tk|ml|ga|cf|top|click|download|loan|racing|review|science|work|party|date|stream|trade|bid|win|cricket|accountant|faith|men|gq)$
      - type: Not
        criteria:
          type: HeaderPattern
          header: authentication-results
          pattern: dkim=pass
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: HeaderPattern
          header: reply-to
          pattern: .*@.*(plex|netflix|spotify|adobe|dropbox|slack|zoom|salesforce|hubspot|mailchimp|constantcontact|sendgrid|mailgun)\..*
        - type: HeaderPattern
          header: reply-to
          pattern: .*@.*(amazon|microsoft|google|apple|paypal|ebay|etsy|walmart|target|costco)\..*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails from young domains (comprehensive check)
  criteria:
    type: And
    criteria:
    - type: DomainAge
      max_age_days: 365
      check_sender: true
      check_reply_to: true
      check_from_header: true
      timeout_seconds: 15
      use_mock_data: false
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(testosterone|male.*enhancement|weight.*loss|diet.*pill|viagra|cialis|miracle.*cure|secret.*formula|health.*breakthrough|medicare.*kit|medicare.*essentials|cvs.*medicare|free.*medicare).*
        - type: SubjectPattern
          pattern: (?i).*(lottery|jackpot|winner|prize|make.*money|find.*money|ancient.*song|effortlessly|helps.*\d+.*find).*
        - type: SubjectPattern
          pattern: (?i).*(password.*expir|account.*expir|verify.*account|security.*alert|urgent.*action|suspended.*account).*
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: (?i).*_(testosterone|male|enhancement|lottery|money|winner|admin|security|verify).*@.*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(admin|security|verify|support|noreply|no-reply).*
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@.*(shop|store|market|commerce|retail|product|launch|backer|crowdfund|kickstart|indiegogo|choice|select|pick).*\.(com|net|org)$
        - type: SenderPattern
          pattern: .*@.*(tech|app|software|platform|service|solution|system|tool|api|cloud|digital|online|web).*\.(com|net|org|io)$
        - type: SenderPattern
          pattern: .*@.*(company|corp|inc|llc|ltd|business|enterprise|group|team|studio|agency|consulting|services).*\.(com|net|org)$
        - type: SenderPattern
          pattern: .*@.*(brand|design|creative|innovation|maker|craft|artisan|boutique|collection|series).*\.(com|net|org)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag brand impersonation from free email
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i)@(outlook|gmail|yahoo|hotmail)\.com$
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(paypal|amazon|microsoft|apple|google|bank|security|account|verify).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(paypal|amazon|microsoft|apple|google|bank).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag bulk spam with undisclosed recipients from free email
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: to
      pattern: (?i)undisclosed.{0,15}recipients
    - type: SenderPattern
      pattern: .*@(outlook|gmail|yahoo|hotmail|aol|msn|live|protonmail|icloud|yandex|mail|gmx)\.(com|net|org|ru)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails with invalid unsubscribe headers
  criteria:
    type: InvalidUnsubscribeHeaders
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails with unsubscribe links using IP addresses
  criteria:
    type: UnsubscribeLinkIPAddress
    check_ipv4: true
    check_ipv6: true
    allow_private_ips: false
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag empty emails from free email services
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@(gmail|outlook|yahoo|hotmail|aol)\.(com|net|org)$
    - type: EmptyContentEmail
      max_text_length: 10
      ignore_whitespace: true
      ignore_signatures: true
      require_empty_subject: false
      min_subject_length: 5
      ignore_html_tags: true
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: HeaderPattern
          header: x-ms-has-attach
          pattern: 'yes'
        - type: HeaderPattern
          header: content-type
          pattern: multipart/mixed
        - type: HeaderPattern
          header: in-reply-to
          pattern: .*
        - type: HeaderPattern
          header: references
          pattern: .*
        - type: SubjectPattern
          pattern: (?i).*(re:|fwd:|fw:|reply|forward|wood|electrical|work|project|business|meeting|appointment|schedule|invoice|quote|estimate|contract|service|repair|fix|install|construction|home|house).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag known abusive Google Group ID 282548616536
  criteria:
    type: Or
    criteria:
    - type: HeaderPattern
      header: x-google-group-id
      pattern: '282548616536'
    - type: HeaderPattern
      header: X-Google-Group-Id
      pattern: '282548616536'
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Unsubscribe from abusive Google Group ID 282548616536
  criteria:
    type: Or
    criteria:
    - type: HeaderPattern
      header: x-google-group-id
      pattern: '282548616536'
    - type: HeaderPattern
      header: X-Google-Group-Id
      pattern: '282548616536'
  action:
    type: UnsubscribeGoogleGroup
    reason: Automated unsubscribe from known abusive Google Group 282548616536
    additional_action:
      type: TagAsSpam
      header_name: X-Spam-Flag
      header_value: 'YES'
- name: Tag random Gmail addresses with keyboard mashing patterns
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: ^[a-z]*[fghjkl]{3,}[a-z]*@gmail\.com$|^[a-z]*[qwerty]{4,}[a-z]*@gmail\.com$|^[a-z]*[asdf]{3,}[a-z]*@gmail\.com$|^[a-z]*[zxcv]{3,}[a-z]*@gmail\.com$|^[a-z]{15,}@gmail\.com$|^[a-z]{2,}[0-9]{6,}@gmail\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SubjectPattern
        pattern: (?i).*(order.*status|order.*#|tracking|shipment|delivery|invoice|receipt|payment|refund|confirm|verification|account|suspended|expired).*
      - type: HeaderPattern
        header: to
        pattern: (?i)[a-z]+ [a-z]+
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Car Emergency Kit and reward kit scams
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(car.*emergency.*kit|emergency.*car.*kit|car.*kit.*confirmed|emergency.*kit.*confirmed|aaa.*car.*kit|car.*safety.*kit|roadside.*kit|auto.*emergency|your.*kit.*is.*queued|kit.*queued.*for.*delivery|kit.*is.*ready|reward.*kit|cvs.*kit|pharmacy.*kit|health.*kit|safety.*kit|tool.*set.*is.*ready|your.*tool.*set|tool.*kit|harbor.*freight.*kit|tools.*ready|tool.*delivery).*
      - type: SubjectPattern
        pattern: .*WW91ciBGcmVlIENhciBFbWVyZ2VuY3kgS2l0IGlzIFJlYWR5IQ==.*
    - type: Or
      criteria:
      - type: And
        criteria:
        - type: Or
          criteria:
          - type: HeaderPattern
            header: from
            pattern: (?i)(aaa|cvs|pharmacy|health.*rewards|safety.*rewards|harbor.*freight|tools)
          - type: SubjectPattern
            pattern: (?i)(aaa|cvs|pharmacy|health.*rewards|safety.*rewards|harbor.*freight|tools)
        - type: Not
          criteria:
            type: SenderPattern
            pattern: .*@(aaa|csaa|cvs|cvshealth|harborfreight)\.com$
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=(fail|permerror|temperror)
      - type: SenderPattern
        pattern: .*@.*\.(onmicrosoft\.com|gappssmtp\.com|bounces\.google\.com)$
      - type: SenderPattern
        pattern: .*@.*(entrprise|enterprize|buisness|compnay|servce|suport|dailydials).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Amazon.co.jp brand impersonation from non-Amazon domains
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i)amazon\.co\.jp
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(amazon\.co\.jp|amazon\.com|amazonses\.com)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious PDF attachments with financial content
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: content-type
      pattern: multipart/mixed
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(paiement|payment|facture|invoice|rappel|reminder|bailleur|landlord|loyer|rent|direct.*pay|pay.*direct|banking|bank.*transfer|wire.*transfer|urgent.*payment).*
      - type: HeaderPattern
        header: to
        pattern: (?i).*(payment|paiement|billing|finance|accounting|bank).*
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SenderPattern
        pattern: .*@.*\.(edu|ac\.[a-z]{2}|ugr\.es|univ-.*|university).*
      - type: And
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(rappel|paiement|facture|bailleur|loyer).*
        - type: Not
          criteria:
            type: SenderPattern
            pattern: .*@.*(bank|banque|finance|accounting|payment|billing)\.(com|fr|ca)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails with RAR attachments (high malware risk)
  criteria:
    type: AttachmentOnlyEmail
    max_text_length: 500
    suspicious_types:
    - rar
    min_attachment_size: 1024
    check_disposition: true
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious attachment-only emails
  criteria:
    type: And
    criteria:
    - type: AttachmentOnlyEmail
      max_text_length: 100
      suspicious_types:
      - pdf
      - doc
      - docx
      - rar
      - zip
      - exe
      min_attachment_size: 1024
      check_disposition: true
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: ^[a-z0-9]{6,}@gmail\.com$
      - type: SenderPattern
        pattern: ^[a-z]{3,}[0-9]{2,}@(gmail|outlook|yahoo|hotmail)\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SubjectPattern
        pattern: ^[A-Z0-9_]{6,}$
      - type: HeaderPattern
        header: received
        pattern: .*gmailapi\.google\.com.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag phishing with DKIM failure and domain mismatch
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: authentication-results
      pattern: dkim=fail
    - type: SenderPattern
      pattern: .*@.*\.(top|tk|ml|ga|cf|click|download|loan|racing|review|science|work|party|date|stream|trade|bid|win|cricket|accountant|faith|men|gq)$
    - type: HeaderPattern
      header: reply-to
      pattern: .*@(gmail|outlook|yahoo|hotmail|zoho|aol|protonmail)\.(com|net|org)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag bulk financial threats from educational domains
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: to
      pattern: (?i)undisclosed.{0,15}recipients
    - type: SubjectPattern
      pattern: (?i)(unpaid|charges?|amount|\$[0-9]+\.?[0-9]*|activation|order.*underway|underway|processing|pending|awaiting|confirmation)
    - type: SenderPattern
      pattern: .*@.*(edu|school|raiders|athletics|university|college|\.ac\.)\.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag email service abuse (comprehensive)
  criteria:
    type: EmailServiceAbuse
    legitimate_services:
    - sendgrid.net
    - mailchimp.com
    - constantcontact.com
    - mailgun.com
    - sparkpostmail.com
    - citebanner.com
    - exacttarget.com
    - salesforce.com
    - pardot.com
    brand_keywords:
    - ebay
    - paypal
    - amazon
    - microsoft
    - apple
    - google
    - netflix
    - spotify
    - adobe
    - dropbox
    - slack
    - zoom
    - citibank
    - citi
    - bank of america
    - bofa
    - chase
    - wells fargo
    - capital one
    - discover
    - american express
    - amex
    - visa
    - mastercard
    - venmo
    - zelle
    - quickpay
    - apple pay
    - google pay
    - walmart
    - target
    - costco
    - home depot
    - lowes
    - best buy
    - macys
    - nordstrom
    - pure hockey
    - dicks sporting goods
    - sports authority
    - modells
    - big 5
    - academy sports
    - rei
    - cabelas
    - bass pro shops
    - kohls
    - jcpenney
    - sears
    - bed bath beyond
    - pier 1
    - williams sonoma
    - pottery barn
    - crate barrel
    - irs
    - social security
    - medicare
    - usps
    - fedex
    - ups
    - dhl
    free_email_domains:
    - outlook.com
    - gmail.com
    - yahoo.com
    - hotmail.com
    - aol.com
    - protonmail.com
    - icloud.com
    check_reply_to_mismatch: true
    check_brand_impersonation: true
    check_suspicious_subjects: true
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag brand impersonation with authentication failures
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=fail
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(pure hockey|dicks sporting|sports authority|modells|big 5|academy
          sports|rei|cabelas|bass pro|tractor supply).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(walmart|target|costco|home depot|lowes|best buy|macys|nordstrom|kohls|jcpenney|cvs|walgreens|rite
          aid).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(amazon|microsoft|apple|google|netflix|spotify|adobe|quickbooks|intuit|docusign).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(paypal|chase|wells fargo|bank of america|citibank|capital
          one).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(medicare|medicaid|social security|irs|usps|fedex|ups|dhl).*
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(purehockey|pure-hockey)\.com$
        - type: SenderPattern
          pattern: .*@(amazon|microsoft|apple|google|netflix|spotify|adobe|paypal|chase|wellsfargo|bankofamerica|citibank|capitalone|walmart|target|costco|homedepot|lowes|bestbuy|macys|nordstrom|cvs|walgreens|riteaid|medicare|medicaid|ssa|irs|usps|fedex|ups|dhl)\.com$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag retargeting spam with suspicious patterns
  criteria:
    type: And
    criteria:
    - type: SubjectPattern
      pattern: (?i).*(browsing.*for|were.*you.*browsing|left.*something|cart.*reminder|still.*interested|finish.*purchase|complete.*order|abandoned.*cart).*
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SenderPattern
        pattern: .*@(citebanner|emailbanner|mailbanner|adsbanner|marketingbanner)\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(pure hockey|dicks sporting|sports authority|rei|cabelas|bass
          pro|walmart|target|costco|home depot|best buy).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(amazon|microsoft|apple|google|netflix|spotify|adobe|paypal).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag pharmaceutical and health spam
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(t-level|testosterone|manhood|male.*enhancement|erectile|libido|stamina.*enhancement|sexual.*performance|enhance.*sexual|boost.*testosterone|enhance.*virility|boost.*libido|virility|potency).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(manhood|testosterone|male.*enhancement|virility|potency|libido).*
        - type: SenderPattern
          pattern: (?i).*_(manhood|testosterone|male|virility|potency|libido).*@.*
      - type: SubjectPattern
        pattern: (?i).*(weight.*loss|lose.*weight|diet.*pill|fat.*burn|belly.*fat|keto|garcinia|forskolin).*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(empty.*bladder|bladder.*control|urinary.*health|prostate.*health|bladder.*problem|urinary.*problem|frequent.*urination|bladder.*leak|incontinence).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(bladder|urinary|prostate|tonic|health.*supplement|medical.*solution).*
        - type: SenderPattern
          pattern: (?i).*_(bladder|urinary|prostate|tonic|health|medical).*@.*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(health.*secret|wellness.*secret|natural.*remedy|herbal.*remedy|health.*breakthrough|medical.*breakthrough|doctor.*secret|ancient.*remedy|joint.*heal|joint.*repair|joint.*replacement|surgery.*alternative|without.*surgery|cancels.*surgery|cancel.*surgery|avoid.*surgery|skip.*surgery|no.*surgery.*needed|surgery.*free|heal.*joint|repair.*joint|alzheimer|dementia|brain.*health|memory.*loss|cognitive|neurological|drink.*linked|food.*linked|avoid.*this.*drink|ditch.*this.*drink|stop.*drinking|dangerous.*drink|diabetes|diabetic|blood.*sugar|a1c|insulin|reverse.*diabetes|cure.*diabetes|beat.*diabetes|type.*2.*diabetes|blood.*glucose).*
        - type: SubjectPattern
          pattern: (?i).*(no.*chemo.*needed|chemo.*alternative|cancer.*cure|cure.*cancer|beat.*cancer|reverse.*cancer|cancer.*secret|cancer.*breakthrough|nobel.*prize.*discovery|nobel.*discovery|cancer.*flush|flush.*cancer|eliminate.*cancer|destroy.*cancer|kill.*cancer|cancer.*cells|tumor.*shrink|shrink.*tumor|oncologist.*hate|doctors.*hate.*this|big.*pharma.*hate|pharma.*doesn.*want|medical.*industry.*hate).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(health|wellness|remedy|natural|herbal|medical|doctor|ancient|tonic|supplement|joint|heal|repair|surgery|ditch|avoid|stop|brain|memory|cognitive|cancer|chemo|cure|flush).*
        - type: SenderPattern
          pattern: (?i).*(joint|heal|repair|surgery|medical|health|wellness|remedy|natural|ditch|avoid|stop|brain|memory|cognitive).*@.*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(viagra|cialis|levitra|pharmacy|prescription|medication|pills|supplement|cure|treatment).*
        - type: SubjectPattern
          pattern: (?i).*(secret.*formula|miracle.*cure|doctor.*recommend|clinically.*proven|breakthrough).*
        - type: SubjectPattern
          pattern: (?i).*(medicare.*kit|medicare.*essentials|cvs.*medicare|free.*medicare|medicare.*benefits|medicare.*coverage|medicare.*plan|cvs.*kit|pharmacy.*kit|health.*kit).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(medicare|cvs.*medicare|pharmacy.*kit|health.*kit|medicare.*kit).*
      - type: SubjectPattern
        pattern: (?i).*(overnight.*result|instant.*result|rapid.*weight|amazing.*result|incredible.*result|shocking.*result|secret.*health|miracle.*health|breakthrough.*health|revolutionary.*health).*
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@.*(wayfair|amazon|walmart|target|costco|homedepot|lowes|bestbuy|macys|nordstrom|kohls|jcpenney|overstock|bedbathandbeyond|williams-sonoma|potterybarn|crateandbarrel|pier1|ikea)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(aliexpress|alibaba|ebay|etsy|shopify|wish|banggood|gearbest|dhgate|lightinthebox|tomtop|cafago|chinavasion|dealextreme|focalprice|miniinthebox|rosegal|sammydress|zaful|shein|romwe)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(fitbit|myfitnesspal|weightwatchers|nutrisystem|peloton|nike|adidas|underarmour|lululemon|gymshark)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(gnc|vitaminworld|iherb|vitacost|swansonvitamins|puritan|naturemade|centrum|optimumnutrition)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*(walgreens|cvs|cvshealth|rite-aid|riteaid|pharmacy|rxorder|prescription|medco|express-scripts|expressscripts|caremark|optumrx|humana|aetna|cigna|bluecross|anthem|iqhealth|virginiamason|mayoclinic|clevelandclinic|johnshopkins|mountsinai|cedars-sinai|kp\.org|kaiserpermanente|sutter|providence|intermountain|adventhealth|commonspirit|ascension|hca|tenet|lifepoint|communityhealth|universalhealth|selectmedical|encompasshealth|kindred|genesis|brookdale|amedisys|lhc|almost-family|chemed|encompass|healthsouth|kindredhealthcare|post-acute|skilled-nursing|rehabilitation|hospice|home-health|medical-center|hospital|clinic|health-system|healthcare|healthpartners|bcbs|blueshield|unitedhealthcare|wellcare|molina|centene|medicaid|medicare)\.(com|net|org)$
        - type: SenderPattern
          pattern: .*@.*(arrived|fundrise|yieldstreet|realty|realtyshares|crowdstreet|roofstock|groundfloor|republic|seedinvest|startengine|wealthfront|betterment|robinhood|schwab|fidelity|vanguard|etrade|tdameritrade)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*fidelity\.netbenefits\.com$
        - type: SenderPattern
          pattern: .*@.*(salesforce|hubspot|mailchimp|constantcontact|sendgrid|mailgun|customer\.io|intercom|zendesk|slack|microsoft|google|adobe|dropbox|box|zoom|webex|gotomeeting)\.(com|net)$
        - type: SenderPattern
          pattern: .*@.*\.(customeriomail|mailgun|sendgrid|constantcontact|mailchimp)\.(com|net)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious TLDs and hosting with spam content
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@.*\.(shop|store|online|site|website|web|click|download|loan|racing|review|science|work|party|date|stream|trade|bid|win|cricket|accountant|faith|men|gq|tk|ml|ga|cf|top|fun|live|life|world|today|news|info|buzz|cool|best|cheap|free|sale|sbs|xyz|pw|cc|tv|me|co|io|ly|be|ws|am|fm|to|cfd|icu|cyou|bond|lol|fans|club|vip|pro|tech)$
      - type: HeaderPattern
        header: received
        pattern: .*(greencloudvps|cheapvps|hostinger|namecheap|godaddy)\.(com|net).*
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(secret.*health|miracle.*cure|breakthrough.*health|overnight.*result|instant.*result|amazing.*result|incredible.*result|shocking.*result|revolutionary.*health|ripped.*muscle|soaring.*testosterone|boost.*testosterone|enhance.*performance|increase.*stamina|empty.*bladder|bladder.*control|urinary.*health|prostate.*health|natural.*remedy|ancient.*remedy|health.*tonic|joint.*heal|joint.*repair|joint.*replacement|surgery.*alternative|without.*surgery|heal.*joint|repair.*joint).*
      - type: SubjectPattern
        pattern: (?i).*(find.*money|make.*money|effortlessly|ancient.*song|lottery|jackpot|winner|prize|helps.*\d+.*find|thousands.*discovered).*
      - type: SenderPattern
        pattern: (?i).*(manhood|testosterone|male|virility|potency|libido|sexy|adult|xxx|davinci_brain|money_maker|lottery_winner|tonic|bladder|urinary|prostate|health|wellness|remedy).*@.*
      - type: SubjectPattern
        pattern: (?i).*(grandpa.*secret|doctor.*hate|weird.*trick|one.*simple.*trick|this.*will.*shock|ancient.*song|helps.*\d+).*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@.*(wayfair|amazon|walmart|target|costco|homedepot|lowes|bestbuy|macys|nordstrom|kohls|jcpenney|overstock|bedbathandbeyond|williams-sonoma|potterybarn|crateandbarrel|pier1|ikea|shopify|etsy|ebay|aliexpress|alibaba|wish|banggood|gearbest|dhgate|shein|romwe)\.(com|net)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag inappropriate sender names and adult content
  criteria:
    type: Or
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(your.*manhood|your.*penis|your.*member|male.*enhancement|testosterone|virility|potency|libido).*
      - type: SenderPattern
        pattern: (?i).*(manhood|penis|member|testosterone|virility|potency|libido|sexy|adult|xxx|porn).*@.*
    - type: SenderPattern
      pattern: (?i).*_(manhood|penis|member|testosterone|male|virility|potency|libido|sexy|adult|xxx).*@.*
    - type: SenderPattern
      pattern: .*@.*(adult|xxx|sex|porn|manhood|testosterone|male|virility|enhancement).*\.(shop|store|online|site|tk|ml|ga|cf|top)$
    - type: SubjectPattern
      pattern: (?i).*(sex.*industry|penis.*ritual|adult.*content|xxx|porn|sexual.*enhancement|male.*enhancement|grow.*penis|enlarge.*penis|bigger.*penis|sexual.*performance|bedroom.*performance).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag testosterone and male enhancement spam patterns
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(t-level|testosterone|manhood|male.*enhancement|ripped.*grandpa|secret.*to.*send|levels.*soaring|overnight|boost.*testosterone).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(your.*manhood|testosterone|male.*enhancement|t.*level|boost|enhance).*
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@.*\.shop$
      - type: HeaderPattern
        header: received
        pattern: .*(greencloudvps|cheapvps|hostinger)\.(com|net).*
      - type: SenderPattern
        pattern: (?i).*_(manhood|testosterone|male|boost|enhance).*@.*
      - type: SubjectPattern
        pattern: (?i).*(grandpa.*secret|secret.*to|overnight|soaring|ripped|weird.*trick|doctors.*hate).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag financial scams and get-rich-quick schemes
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(find.*money|make.*money|earn.*money|easy.*money|fast.*money|quick.*money|effortlessly|ancient.*song|secret.*method|weird.*trick).*
      - type: SubjectPattern
        pattern: (?i).*(lottery.*winner|jackpot.*winner|you.*won|congratulations.*winner|prize.*winner|sweepstakes.*winner|contest.*winner|lucky.*winner|fortune.*winner|windfall).*
      - type: SubjectPattern
        pattern: (?i).*(investment.*opportunity|trading.*secret|forex.*system|crypto.*mining|bitcoin.*investment|stock.*tip|insider.*trading|guaranteed.*return|passive.*income).*
      - type: SubjectPattern
        pattern: (?i).*(charity.*work|donation|donate.*money|sick.*bed|dying.*wish|inheritance|will.*money|beneficiary|million.*usd|million.*dollars|fund.*transfer|widow|orphan|refugee|disaster.*relief).*
      - type: SubjectPattern
        pattern: (?i).*(business.*funding|business.*loan|quick.*loan|easy.*loan|guaranteed.*loan|no.*credit.*check|instant.*approval|funding.*available|capital.*funding|investment.*funding|unsecured.*loan|bad.*credit.*loan|emergency.*funding).*
      - type: SubjectPattern
        pattern: (?i).*(credit.*card.*fee|removing.*fee|eliminate.*fee|reduce.*fee|lower.*fee|processing.*fee|merchant.*fee|payment.*fee|transaction.*fee|card.*processing|fee.*elimination|zero.*fee|no.*fee).*
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(amazon|amazonses|walmart|target|costco|bestbuy|ebay|paypal|microsoft|google|apple|netflix|spotify|adobe|dropbox)\.(com|net)$
        - type: SenderPattern
          pattern: .*@(chase|bankofamerica|wellsfargo|citibank|usbank|capitalone|discover|americanexpress|schwab|fidelity|vanguard|etrade|robinhood)\.(com|net)$
        - type: And
          criteria:
          - type: HeaderPattern
            header: authentication-results
            pattern: (?i)dkim=pass
          - type: SenderPattern
            pattern: .*@(gmail|outlook|yahoo|hotmail)\.(com|net)$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(davinci.*brain|money.*maker|wealth.*builder|fortune.*teller|lottery.*winner|cash.*flow).*
      - type: SenderPattern
        pattern: (?i).*(davinci_brain|money_maker|wealth_builder|fortune_teller|lottery_winner|cash_flow).*@.*
    - type: SubjectPattern
      pattern: (?i).*(helps.*\d+.*find|\d+.*people.*found|thousands.*discovered|millions.*earned|guaranteed.*income|no.*work.*required).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag WordPress compromise and malicious phishing links
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(password.*expir|password.*notif|account.*expir|login.*expir|security.*alert|verify.*account).*
      - type: Or
        criteria:
        - type: HeaderPattern
          header: received
          pattern: .*/wp-admin/.*
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(express-scripts|cvs|walgreens|rite-aid|optum|humana|anthem|aetna|cigna|bluecross|kaiser|unitedhealth)\.(com|net)$
        - type: SenderPattern
          pattern: .*@(okta|auth0|ping|onelogin|duo|microsoft|google|apple|amazon)\.(com|net)$
        - type: HeaderPattern
          header: received
          pattern: .*okta\.com.*
        - type: HeaderPattern
          header: from
          pattern: .*express-scripts.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag domain impersonation in display names with DKIM failures
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i).*baddomain\.com.*<.*@.*>.*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@baddomain\.com$
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=fail
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(password.*expir|password.*notif|account.*expir|security.*alert|login.*expir|verify.*account|account.*suspend|email.*delivery.*issue|delivery.*issue|email.*problem|mail.*delivery.*fail|bounce.*notification|undelivered.*mail|delivery.*status|email.*not.*delivered).*
      - type: HeaderPattern
        header: reply-to
        pattern: (?i).*@.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag password expiration phishing attempts
  criteria:
    type: And
    criteria:
    - type: SubjectPattern
      pattern: (?i).*(password.*expir|password.*notif|account.*expir|login.*expir|security.*alert|verify.*account|account.*suspend|password.*reset|credentials.*expir|ssl.*certificate.*renewal|certificate.*renewal|ssl.*expir|certificate.*expir|certificate.*deferred|ssl.*deferred|domain.*expir|hosting.*expir|website.*expir|renewal.*deferred|certificate.*notif|ssl.*notif).*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@baddomain\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SenderPattern
        pattern: .*@.*(remix|music|song|temp|test|demo|maintenance|service|support|security|verify|update|login|portal).*\.(com|net|org)$
      - type: And
        criteria:
        - type: HeaderPattern
          header: reply-to
          pattern: .*@.*
        - type: Not
          criteria:
            type: HeaderPattern
            header: reply-to
            pattern: .*@baddomain\.com.*
      - type: HeaderPattern
        header: body
        pattern: .*/wp-admin/.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Portuguese and international phishing attempts
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(administra.*o|transa.*es|digitais|financeiro|banco|documento|contrato|revis.*o|verifica.*o|seguran.*a|autentica.*o|mercadolivre|mercado.*livre|suporte|atendimento|vendas|compras|delegacia|policia|autoridade|registro|ocorrencia|boletim).*
      - type: SubjectPattern
        pattern: (?i).*(documento|contrato|transa.*o|administra.*o|verifica.*o|revis.*o|dispon.*vel|urgente|importante|seguran.*a|detalhes.*do.*seu.*pedido|pedido|mercadolivre|mercado.*livre|compra|venda|entrega|pagamento|fatura|boleto|pendente|assinatura|protocolo|delegacia|policia|registro.*ocorrencia|boletim.*ocorrencia|aviso.*sobre).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(administraci.*n|transacci.*n|digitales|financiero|banco|documento|contrato|revisi.*n|verificaci.*n|seguridad|autenticaci.*n).*
      - type: SubjectPattern
        pattern: (?i).*(documento|contrato|transacci.*n|administraci.*n|verificaci.*n|revisi.*n|disponible|urgente|importante|seguridad).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(administration|transaction|num.*rique|financier|banque|document|contrat|r.*vision|v.*rification|s.*curit.*|authentification).*
      - type: SubjectPattern
        pattern: (?i).*(document|contrat|transaction|administration|v.*rification|r.*vision|disponible|urgent|important|s.*curit.*).*
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: HeaderPattern
        header: received
        pattern: .*\.bc\.googleusercontent\.com.*
      - type: SenderPattern
        pattern: .*@.*\.(online|site|website|tk|ml|ga|cf|top|shop|store)$
      - type: SenderPattern
        pattern: .*@[a-z0-9]{4,8}\.[a-z]+\.(com|net|org|online)$
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@.*(newegg|amazon|ebay|walmart|target|bestbuy|homedepot|lowes|costco|samsclub|macys|nordstrom|zappos|overstock|wayfair|etsy|shopify|paypal|stripe|square)\.com$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Portuguese financial phishing (broader detection)
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(financiamento.*aprovado|documento.*pendente|pendente.*assinatura|protocolo.*\d+|contrato.*assinatura|assinatura.*digital|certificado.*digital|documento.*digital|aprovado.*documento|documento.*aprovado).*
      - type: SubjectPattern
        pattern: (?i).*(certisign|certificado|assinatura|protocolo|documento|contrato|financiamento|aprovado|pendente).*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(certisign|docusign|adobe|microsoft|google|itau|bradesco|santander|bb|caixa|nubank|inter|original|c6bank|safra|votorantim|sicredi|sicoob|banrisul|bnb|banese|banpara|brb|banese|banestes|banese|banpara|brb|banese|banestes)\.com(\.br)?$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag document and contract scam attempts
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(document.*available|contract.*available|document.*review|contract.*review|documento.*dispon|contrato.*dispon|document.*urgent|contract.*urgent).*
      - type: Or
        criteria:
        - type: HeaderPattern
          header: from
          pattern: (?i).*(administration|administra.*o|administraci.*n|transaction|transa.*o|transacci.*n|digital.*transaction|financial.*administration|document.*administration).*
        - type: SenderPattern
          pattern: (?i).*(admin|administration|transaction|document|contract|financial|digital).*\d+@.*
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: HeaderPattern
        header: received
        pattern: .*(googleusercontent|amazonaws|digitalocean)\.com.*
      - type: SenderPattern
        pattern: .*@.*\.(online|site|website|tk|ml|ga|cf|top|shop|store|click)$
      - type: SenderPattern
        pattern: .*@[a-z0-9]{4,8}\.[a-z]+online\.(com|net|org)$
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(docusign|hellosign|adobe|pandadoc|signnow|echosign|rightfax|esignlive|signrequest|signable)\.(com|net)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag .shop domain spam campaigns
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@.*\.shop$
    - type: Or
      criteria:
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(empty.*bladder|bladder.*control|t-level|testosterone|manhood|male.*enhancement|weight.*loss|health.*secret|natural.*remedy|ancient.*remedy|tonic|supplement|joint.*heal|joint.*repair|joint.*replacement|surgery.*alternative|without.*surgery|heal.*joint|repair.*joint|alzheimer|dementia|brain.*health|memory.*loss|cognitive|neurological|drink.*linked|food.*linked|avoid.*this.*drink|ditch.*this.*drink|stop.*drinking|dangerous.*drink|diabetes|diabetic|blood.*sugar|a1c|insulin|reverse.*diabetes|cure.*diabetes|beat.*diabetes|type.*2.*diabetes|blood.*glucose|toenail.*fungus|nail.*fungus|foot.*fungus|fungus.*vanish|soak.*feet|feet.*soak|vanish.*fungus|eliminate.*fungus|tinnitus|hearing.*loss|ear.*ringing|stop.*eating|harvard.*warns|doctors.*warn|study.*reveals|research.*shows|scientists.*discover|constipation|bowel.*trick|bowel.*movement|apple.*cider.*vinegar|digestive.*health|gut.*health|colon.*cleanse|detox|cleanse|listerine.*on.*your.*toes|pour.*listerine|listerine.*toes|weird.*but.*genius|toenails|toe.*nails|can.*t.*get.*out.*of.*bed|no.*energy|tired.*all.*the.*time|exhausted|fatigue|boost.*energy|increase.*energy|vitamin.*deficiency|low.*energy|harvard.*stretch|stretch.*your.*foot|foot.*stretch|stretch.*like.*this|poor.*balance|balance.*problem).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(tonic|health|wellness|remedy|natural|herbal|medical|bladder|urinary|prostate|testosterone|manhood|enhancement|joint|heal|repair|surgery|ditch|avoid|stop|brain|memory|cognitive|constipation|bowel|digestive|gut|colon|detox|cleanse|toenails|nails|fungus|vitamin|supplement|energy|boost|fatigue|tired).*
        - type: SenderPattern
          pattern: (?i).*(joint|heal|repair|surgery|medical|health|wellness|remedy|natural|ditch|avoid|stop|brain|memory|cognitive).*@.*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(find.*money|make.*money|lottery|jackpot|ancient.*song|effortlessly|helps.*\d+.*find|davinci.*brain).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(money|lottery|jackpot|davinci|brain|wealth|fortune|cash).*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(service.*promotion|promotional.*offer|special.*deal|limited.*offer|exclusive.*access|messages.*waiting|waiting.*review|pending.*messages|messages.*pending|admin.*support|system.*notification|account.*notification).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(service|promotion|deal|offer|exclusive).*
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(reward.*you|rewards.*you|you.*won|winner|prize|congratulations|selected.*for|chosen.*for|claim.*your|expires.*soon|limited.*time|trailer.*reward|gift.*card|free.*gift|exclusive.*offer|special.*offer).*
        - type: And
          criteria:
          - type: SubjectPattern
            pattern: (?i).*(tractor.*supply|home.*depot|lowes|walmart|target|costco|amazon|best.*buy|cvs|walgreens|aaa|state.*farm|geico|progressive).*
          - type: Not
            criteria:
              type: SenderPattern
              pattern: .*@(tractorsupply|homedepot|lowes|walmart|target|costco|amazon|bestbuy|cvs|walgreens|aaa|statefarm|geico|progressive)\.(com|net)$
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(don't.*miss.*out|limited.*time|first.*application|special.*offer|\$\d+\.\d+|discount|save.*\$|act.*now|call.*now|free.*estimate|partner|resources|application|treatment|service).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(partner|resources|service|treatment|application|lawn|green|care|maintenance|discount|offer|deal).*
        - type: SenderPattern
          pattern: (?i).*(partner|resources|service|treatment|application|lawn|green|care|maintenance).*@.*
      - type: SenderPattern
        pattern: (?i).*_(tonic|health|wellness|remedy|bladder|urinary|prostate|testosterone|manhood|money|lottery|brain).*@.*
    - type: HeaderPattern
      header: return-path
      pattern: .*\d+-\d+-\d+-\d+-.*=.*@mail\.[a-z]+\.shop.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid phishing using heuristic scoring (scalable approach)
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: return-path
        pattern: .*@.*sendgrid\.net$
      - type: HeaderPattern
        header: received
        pattern: .*sendgrid\.net.*
    - type: Or
      criteria:
      - type: And
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(thank.*you.*for.*(your.*(purchase|order|payment|shopping)|joining|subscribing|signing.*up|shopping.*with)|your.*(order|purchase|payment|subscription|membership).*is.*(ready|complete|confirmed|active)|payment.*(received|confirmed|processed)|purchase.*(confirmation|receipt)|order.*(confirmation|receipt)|welcome.*to.*(prime|membership|subscription)|order.*#.*wal-.*\d+|order.*#.*amz-.*\d+|order.*#.*tgt-.*\d+|case.*#.*\d+|payment.*declined|payment.*failed|billing.*issue|update.*billing|your.*walmart.*order|order.*summary.*\(.*#|walmart.*order.*#|walmart.*order.*summary).*
        - type: Or
          criteria:
          - type: HeaderPattern
            header: authentication-results
            pattern: (?i)dkim=fail
          - type: Not
            criteria:
              type: SenderPattern
              pattern: .*@(amazon|ebay|paypal|stripe|square|shopify|etsy|walmart|target|bestbuy|homedepot|lowes|macys|nordstrom|apple|microsoft|google)\.(com|net)$
      - type: And
        criteria:
        - type: SubjectPattern
          pattern: (?i)^(order|purchase|payment|transaction|invoice|receipt|delivery|shipping|account|notification|alert|update|confirmation|case|ticket|support|help|service).*
        - type: Or
          criteria:
          - type: HeaderPattern
            header: authentication-results
            pattern: (?i)dkim=fail
          - type: HeaderPattern
            header: list-unsubscribe
            pattern: https://mc\.sendgrid\.com/
          - type: SenderPattern
            pattern: .*@[a-z]{3,8}\.(com|net|org)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid with generic subjects (no DKIM requirement)
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: return-path
        pattern: .*@.*sendgrid\.net$
      - type: HeaderPattern
        header: received
        pattern: .*sendgrid\.net.*
    - type: SubjectPattern
      pattern: (?i)^(order.*details|order.*status|order.*confirmation|transaction.*details|transaction.*receipt|payment.*details|invoice.*details|receipt.*details|delivery.*details|shipping.*details|address.*update|address.*confirmation|confirmation.*for.*your|update.*confirmation|\$\d+\.\d+.*sent|money.*sent|payment.*sent|transfer.*complete|funds.*sent|\$\d+.*transfer|receipt.*#\d+|invoice.*#\d+|transaction.*#\d+|\$\d+\.\d+.*charged|\$\d+\.\d+.*billed|\$\d+\.\d+.*paid|payment.*charged|payment.*billed|application.*information|application.*details|information.*request|document.*information|account.*information|card.*application.*confirmation|credit.*card.*application|visa.*card.*application.*confirmation|visa.*card.*application|application.*confirmation|suspicious.*transaction.*alert|thank.*you.*for.*your.*purchase|zelle.*transfer.*receipt|zelle.*payment.*receipt|zelle.*receipt|venmo.*transfer.*receipt|venmo.*payment.*receipt|cashapp.*transfer.*receipt|paypal.*transfer.*receipt|wire.*transfer.*receipt|wire.*transfer.*confirmation|bank.*transfer.*receipt|bank.*transfer.*confirmation|transfer.*receipt|transfer.*confirmation|payment.*receipt|payment.*confirmation)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Report and tag SendGrid abuse with DKIM failures and generic subjects
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: return-path
        pattern: .*@sendgrid\.net$
      - type: HeaderPattern
        header: received
        pattern: .*sendgrid\.net.*
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=fail
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(welcome|hello|hi|greetings|notification|alert|update|message|important|urgent|test|transaction|document|file|info|information|details|report|summary).*
      - type: SubjectPattern
        pattern: (?i).*(processing.*fee|one.*time.*fee|payment.*required|fee.*required|account.*fee|service.*fee|verification.*fee|transaction.*fee|paypal|payment.*pending|payment.*failed|payment.*declined|invoice|receipt|refund|chargeback|thank.*you.*for.*your.*purchase|purchase.*confirmation|order.*confirmation|payment.*confirmation|transaction.*complete).*
      - type: SubjectPattern
        pattern: (?i).*(order.*#|order.*number|order.*:\s*\d|#.*\d{3,}|order.*\d{3,}).*
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(gmail|outlook|yahoo|hotmail|aol)\.(com|net)$
        - type: HeaderPattern
          header: reply-to
          pattern: .*@(gmail|outlook|yahoo|hotmail|aol)\.(com|net)$
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: .*[a-z]+\d{5,}@(gmail|outlook|yahoo|hotmail)\.(com|net)$
        - type: HeaderPattern
          header: reply-to
          pattern: .*[a-z]+\d{5,}@(gmail|outlook|yahoo|hotmail)\.(com|net)$
  action:
    type: ReportAbuse
    service_provider: sendgrid
    include_headers: true
    include_body: false
    report_message: SendGrid infrastructure abuse with DKIM failure and suspicious
      patterns
    additional_action:
      type: TagAsSpam
      header_name: X-Spam-Flag
      header_value: 'YES'
- name: Tag PayPal phishing attempts
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(processing.*fee|one.*time.*fee|payment.*required|fee.*required|account.*fee|service.*fee|verification.*fee|transaction.*fee|paypal|payment.*pending|payment.*failed|payment.*declined|invoice.*paypal|paypal.*invoice|refund.*paypal|paypal.*refund).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*paypal.*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(paypal|paypal-communication)\.(com|net)$
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@(gmail|outlook|yahoo|hotmail|aol)\.(com|net)$
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: Or
        criteria:
        - type: HeaderPattern
          header: return-path
          pattern: .*@sendgrid\.net$
        - type: HeaderPattern
          header: received
          pattern: .*(sendgrid|mailchimp|constantcontact|mailgun)\.net.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Amazon brand impersonation attempts
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i).*amazon.*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(amazon|amazonses|amazon-corp)\.(com|net)$
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@(gmail|outlook|yahoo|hotmail|aol)\.(com|net)$
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: Or
        criteria:
        - type: HeaderPattern
          header: return-path
          pattern: .*@sendgrid\.net$
        - type: HeaderPattern
          header: received
          pattern: .*(sendgrid|mailchimp|constantcontact|mailgun)\.net.*
      - type: SubjectPattern
        pattern: (?i).*(order.*#|order.*number|order.*:\s*\d|#.*\d{3,}|order.*\d{3,}|delivery|shipment|tracking|wal-.*\d+|amz-.*\d+|tgt-.*\d+|bb-.*\d+|hd-.*\d+|cvs-.*\d+|ebay.*\d+|etsy.*\d+).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Twilio brand impersonation attempts
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*twilio.*
      - type: SubjectPattern
        pattern: (?i).*twilio.*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(twilio|sendgrid)\.(com|net)$
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(payment.*declined|payment.*failed|billing.*issue|update.*billing|case.*#).*
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=(fail|temperror)
      - type: HeaderPattern
        header: return-path
        pattern: .*@.*sendgrid\.net$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious Gmail addresses with phishing patterns
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@gmail\.com$
    - type: Not
      criteria:
        type: SenderPattern
        pattern: patoertel39@gmail\.com
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: ^[a-z0-9]{10,}@gmail\.com$
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: And
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(order.*status|order.*#|order.*number|tracking|shipment|delivery|invoice|receipt|payment|refund).*
        - type: SenderPattern
          pattern: ^[a-z]{8,}[0-9]*@gmail\.com$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag Microsoft 365/Google Workspace brand impersonation
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@.*\.onmicrosoft\.com$
      - type: HeaderPattern
        header: received
        pattern: .*(gappssmtp|google\.com).*
    - type: HeaderPattern
      header: from
      pattern: (?i).*(harbor.*freight|home.*depot|lowes|walmart|target|costco|amazon|fedex|ups|dhl|usps|dispatch.*team|delivery.*team|shipping.*team|tool.*set|package.*delivery).*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(harborfreight|homedepot|lowes|walmart|target|costco|amazon|fedex|ups|dhl|usps)\.(com|net)$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SubjectPattern
        pattern: (?i).*(tool.*set|package.*delivery|shipment.*ready|delivery.*secured|order.*ready|dispatch|shipping.*notification).*
      - type: SubjectPattern
        pattern: (?i).*#[a-z0-9]{5,}\*?.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid display name brand impersonation
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@.*\.sendgrid\.net$
    - type: HeaderPattern
      header: from
      pattern: (?i).*(docusign|quickbooks|intuit|paypal|amazon|microsoft|apple|google|adobe|netflix|spotify|ebay|walmart|target|costco|home
        depot|lowes|best buy).*
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(document|edocument|received|review|sign|signature|invoice|payment|account|suspended|verify|confirm|urgent|immediate).*
      - type: SubjectPattern
        pattern: (?i).*(tax|refund|irs|revenue|customs|hmrc|ato).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Enhanced DocuSign abuse and impersonation detection
  criteria:
    type: Or
    criteria:
    - type: DocuSignAbuse
      check_reply_to_mismatch: true
      check_panic_subjects: true
      check_suspicious_encoding: true
      min_indicators: 2
    - type: And
      criteria:
      - type: SenderPattern
        pattern: .*@docusign\.com$
      - type: Not
        criteria:
          type: Or
          criteria:
          - type: HeaderPattern
            header: received
            pattern: .*docusign\.(net|com).*
          - type: HeaderPattern
            header: message-id
            pattern: .*@.*docusign\.(net|com).*
          - type: HeaderPattern
            header: dkim-signature
            pattern: d=docusign\.(net|com)
    - type: And
      criteria:
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@docusign\.com$
        - type: HeaderPattern
          header: from
          pattern: (?i).*(docusign|documento).*
        - type: SubjectPattern
          pattern: (?i).*(docusign|documento.*digital|assinatura.*digital).*
      - type: Or
        criteria:
        - type: HeaderPattern
          header: received
          pattern: .*\.(autos|tk|ml|ga|cf|top|click|site|info|biz).*
        - type: HeaderPattern
          header: return-path
          pattern: .*@cliente[0-9]+\.
        - type: HeaderPattern
          header: return-path
          pattern: .*root@.*
        - type: SubjectPattern
          pattern: (?i).*(documento|assinatura|protocolo|seu|esta|pronto|analise|pendente|aguardando|disponivel|revisar).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid abuse with free email sender
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: return-path
        pattern: .*@sendgrid\.net$
      - type: HeaderPattern
        header: received
        pattern: .*sendgrid\.net.*
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@(aol|gmail|outlook|yahoo|hotmail)\.(com|net)$
      - type: HeaderPattern
        header: reply-to
        pattern: .*@(aol|gmail|outlook|yahoo|hotmail)\.(com|net)$
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i)(order|confirmation|receipt|invoice|payment|delivery)
      - type: SubjectPattern
        pattern: (?i).*(order.*#|order.*number|order.*:\s*\d|#.*\d{3,}|order.*\d{3,}).*
      - type: SubjectPattern
        pattern: (?i).*(processing.*fee|one.*time.*fee|payment.*required|fee.*required|account.*fee|service.*fee|verification.*fee|transaction.*fee|paypal|payment.*pending|payment.*failed|payment.*declined|refund|chargeback|thank.*you.*for.*your.*purchase|purchase.*confirmation|order.*confirmation|payment.*confirmation|transaction.*complete).*
      - type: SubjectPattern
        pattern: (?i)^(welcome|hello|hi|greetings|notification|alert|update|message|important|urgent|transaction|document|file|info|information|details|report|summary)$
      - type: Or
        criteria:
        - type: SenderPattern
          pattern: .*[a-z]+\d{5,}@gmail\.com$
        - type: HeaderPattern
          header: reply-to
          pattern: .*[a-z]+\d{5,}@gmail\.com$
  action:
    type: ReportAbuse
    service_provider: sendgrid
    include_headers: true
    include_body: false
    report_message: SendGrid infrastructure abuse with free email sender and suspicious
      patterns
    additional_action:
      type: TagAsSpam
      header_name: X-Spam-Flag
      header_value: 'YES'
- name: Tag Google Groups brand impersonation and reward scams
  criteria:
    type: GoogleGroupsAbuse
    suspicious_domains:
    - '*pool*.com'
    - '*.tk'
    - '*.ml'
    - '*.ga'
    - '*.top'
    - '*.shop'
    - '*aceh*'
    - '*texas*'
    - '*name*'
    reward_keywords:
    - temu
    - reward
    - survey
    - customer experience
    - prize
    - won
    - winner
    - congratulations
    - luxury
    - pillows
    - marriott
    - mariott
    - hotel
    - aaa
    - car kit
    - emergency kit
    suspicious_sender_names:
    - temu
    - reward
    - your_
    - customer
    - marriott
    - mariott
    - hotel
    - support
    - customer-support
    - aaa
    - emergency
    check_domain_reputation: true
    check_reward_subjects: true
    check_suspicious_senders: true
    min_indicators: 2
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag sophisticated email spoofing attacks
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: return-path
      pattern: (?i).*mailer-daemon.*
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=(fail|permerror|temperror)
    - type: SenderPattern
      pattern: .*@.*[A-Z]{2,}[a-z]{2,}[A-Z]{2,}.*\.com$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious mailto-only unsubscribe (excluding legitimate services)
  criteria:
    type: And
    criteria:
    - type: UnsubscribeMailtoOnly
      allow_mixed: true
    - type: Not
      criteria:
        type: Or
        criteria:
        - type: SenderPattern
          pattern: .*@(signnow|docusign|hellosign|pandadoc|adobe)\.com$
        - type: SenderPattern
          pattern: .*@(mailchimp|constantcontact|campaignmonitor)\.com$
        - type: SenderPattern
          pattern: .*@.*(bosch|bosch-home|whirlpool|ge|samsung|lg|frigidaire|kitchenaid|maytag|electrolux|kenmore|viking|thermador|jenn-air|amana|hotpoint|haier|miele|asko|fisher-paykel|dacor|monogram|cafe|profile|artistry|signature).*\.(com|net)$
        - type: HeaderPattern
          header: from
          pattern: .*<.*@.*(bosch|bosch-home|whirlpool|ge|samsung|lg|frigidaire|kitchenaid|maytag|electrolux|kenmore|viking|thermador|jenn-air|amana|hotpoint|haier|miele|asko|fisher-paykel|dacor|monogram|cafe|profile|artistry|signature).*\.(com|net)>.*
        - type: SenderPattern
          pattern: .*@(pdffiller)\.com$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag SendGrid tax authority impersonation scams
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: return-path
        pattern: .*@sendgrid\.net$
      - type: HeaderPattern
        header: received
        pattern: .*sendgrid\.net.*
    - type: SenderPattern
      pattern: .*@(outlook|gmail|yahoo|hotmail|aol)\.(com|net)$
    - type: SubjectPattern
      pattern: (?i).*(tax|irs|revenue|evasion|audit|refund|penalty|notice|official|authority).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Unsubscribe from Google Groups brand impersonation scams
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: list-id
      pattern: .*\.(site|tk|ml|ga|top).*
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(aaa|temu|amazon|reward|prize|sephora|beauty|won|winner|congratulations|selected|chosen).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(reward|prize|emergency.*kit|sephora|beauty|won|winner).*
  action:
    type: UnsubscribeGoogleGroup
    reason: Automated unsubscribe from brand impersonation scam
    additional_action:
      type: TagAsSpam
      header_name: X-Spam-Flag
      header_value: 'YES'
- name: Tag SendGrid purchase phishing with unsubscribe brand spoofing
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: return-path
      pattern: .*@sendgrid\.net$
    - type: SenderPattern
      pattern: .*@(aol|gmail|outlook|yahoo|hotmail)\.(com|net)$
    - type: SubjectPattern
      pattern: (?i).*(thank.*you.*purchase|purchase.*confirmation|order.*confirmation|receipt|transaction).*
    - type: HeaderPattern
      header: list-unsubscribe
      pattern: (?i).*(amazon|ebay|etsy|paypal|apple|google|walmart|target)\.com.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag suspicious Google Cloud bulk emails
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: received
      pattern: .*\.bc\.googleusercontent\.com.*
    - type: Or
      criteria:
      - type: Or
        criteria:
        - type: HeaderPattern
          header: precedence
          pattern: bulk
        - type: HeaderPattern
          header: auto-submitted
          pattern: auto-generated
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: Or
        criteria:
        - type: SubjectPattern
          pattern: (?i).*(document.*dispon|contrato.*dispon|administra.*o|transa.*es|verifica.*o|revis.*o|urgente|importante).*
        - type: HeaderPattern
          header: from
          pattern: (?i).*(administra.*o|transaction|document|contract|financial|digital).*\d+@.*
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@[a-z0-9]{5,}\.[a-z0-9]{5,}\.(me|tk|ml|ga|cf|top|click|site)$
      - type: SenderPattern
        pattern: .*@[a-z0-9]{4,8}\.[a-z]+online\.(com|net|org)$
      - type: SenderPattern
        pattern: .*@.*\.(online|site|website|click|download)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag cloud backup and storage phishing attacks
  criteria:
    type: And
    criteria:
    - type: SubjectPattern
      pattern: (?i).*(cloud.*backup.*stopped|backup.*stopped|storage.*alert|cloud.*storage.*alert|restore.*backup|backup.*expired|storage.*full|cloud.*suspended|backup.*failed|storage.*warning).*
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=(fail|permerror)
      - type: HeaderPattern
        header: from
        pattern: =\?UTF-8\?B\?
      - type: SenderPattern
        pattern: .*@.*\.(info|tk|ml|ga|cf|top|click|xyz)$
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag emails with Unicode mathematical symbol obfuscation
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: =\?UTF-8\?B\?[A-Za-z0-9+/=]{50,}\?=
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=(fail|permerror)
    - type: Or
      criteria:
      - type: HeaderPattern
        header: received
        pattern: .*\.(xyz|tk|ml|ga|cf|top|click).*
      - type: HeaderPattern
        header: return-path
        pattern: (?i)mailer-daemon
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag McDonald's brand impersonation
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i)mcdonald
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(mcdonalds|mcd)\.com$
    - type: Or
      criteria:
      - type: SenderPattern
        pattern: .*@.*mcdonld.*
      - type: HeaderPattern
        header: return-path
        pattern: MAILER-DAEMON
      - type: SubjectPattern
        pattern: (?i).*(sweepstakes|prize|winner|congratulations|qualify|exclusive).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag AAA brand impersonation
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i).*AAA.*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(aaa|csaa|aaaclub|aaasouth|aaanc|aaane|aaawi|aaaco|aaatexas)\.com$
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=fail
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag WeTransfer brand impersonation
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: from
      pattern: (?i)wetransfer
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(wetransfer|we\.tl)\.(com|net)$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: SubjectPattern
        pattern: (?i).*(expired|recover|download.*now|urgent|act.*now).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag MAILER-DAEMON spoofing attacks
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: return-path
      pattern: MAILER-DAEMON
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=fail
      - type: HeaderPattern
        header: received
        pattern: .*\.(vote|tk|ml|ga|cf|top|click|download|loan|racing|review|science|work|party|date|stream|trade|bid|win|cricket|accountant|faith|men|gq).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag MAILER-DAEMON spoofing with DKIM failures
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: return-path
      pattern: (?i).*<.*mailer-daemon.*>.*
    - type: HeaderPattern
      header: authentication-results
      pattern: (?i)dkim=fail
    - type: Not
      criteria:
        type: HeaderPattern
        header: received
        pattern: .*(baddomain\.com|localhost|127\.0\.0\.1).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag sophisticated MAILER-DAEMON + brand impersonation scams
  criteria:
    type: And
    criteria:
    - type: HeaderPattern
      header: return-path
      pattern: (?i)mailer-daemon
    - type: Or
      criteria:
      - type: HeaderPattern
        header: authentication-results
        pattern: (?i)dkim=(permerror|fail)
      - type: Not
        criteria:
          type: HeaderPattern
          header: dkim-signature
          pattern: .*
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(won|free|prize|giveaway|winner|congratulations|beauty.*box|gift|financial|gold|company|investment|crypto|bitcoin|shipment.*pending|confirm.*info|confirm.*your.*info|please.*confirm|delivery.*pending|package.*pending|shipment.*confirmation|delivery.*confirmation).*
      - type: SubjectPattern
        pattern: ".*[\U0001D5D4-\U0001D607\U0001D608-\U0001D63B\U0001D670-\U0001D689\
          \U0001D68A-\U0001D6A3\U0001D400-\U0001D467\U0001D468-\U0001D4B5\U0001D4B6\
          -\U0001D4CF\U0001D4D0-\U0001D503\U0001D504-\U0001D537\U0001D56C-\U0001D59F\
          \U0001D5A0-\U0001D5D3\U0001D5D4-\U0001D607\U0001D608-\U0001D63B\U0001D670\
          -\U0001D689\U0001D68A-\U0001D6A3].*"
      - type: HeaderPattern
        header: subject
        pattern: =\?UTF-8\?B\?.*
    - type: Or
      criteria:
      - type: SubjectPattern
        pattern: (?i).*(sephora|lancome|ulta|amazon|apple|microsoft|google|target|walmart|trader.*joe|rewards|missing.*out|major.*rewards|urgent.*reward).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(sephora|department|beauty|cosmetic|giveaway|trader.*joe|survey.*about|shipment.*pending|support.*|delivery.*pending|package.*pending|confirm.*info).*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Tag keyword stuffing in From header
  criteria:
    type: And
    criteria:
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: .{100,}
      - type: HeaderPattern
        header: from
        pattern: .*[A-Za-z0-9]{20,}.*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(support.*admin|admin.*help|help.*service|service.*account|account.*setup|setup.*mail|mail.*online|online.*desk|desk.*team|team.*center|center.*security|security.*verify|verify.*update|update.*confirm).*
      - type: HeaderPattern
        header: from
        pattern: (?i).*(support.*help.*service|admin.*setup.*mail|account.*verify.*update|online.*desk.*team|help.*service.*account|setup.*mail.*online).*
    - type: Or
      criteria:
      - type: HeaderPattern
        header: from
        pattern: (?i).*(coinbase|paypal|amazon|microsoft|google|apple|netflix|spotify|adobe|dropbox|slack|zoom|salesforce|hubspot|bank|visa|mastercard|amex|chase|wells.*fargo|bofa|citibank|support|admin|helpdesk).*
      - type: SubjectPattern
        pattern: (?i).*(coinbase|paypal|amazon|microsoft|google|apple|netflix|bank|visa|mastercard).*
    - type: Not
      criteria:
        type: SenderPattern
        pattern: .*@(coinbase|coinbase-mail|cb-mail|paypal|paypal-mail|pp-mail|amazon|amazonses|amazon-mail|microsoft|outlook|live|hotmail|msn|google|gmail|googlemail|apple|icloud|me|netflix|spotify|adobe|dropbox|slack|zoom|salesforce|hubspot)\.com$
  action:
    type: Reject
    message: Keyword stuffing in From header detected - likely brand impersonation
      scam
- name: Tag sender spoofing and domain impersonation
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@baddomain\.com$
    - type: Or
      criteria:
      - type: HeaderPattern
        header: received
        pattern: .*googleusercontent\.com.*
      - type: HeaderPattern
        header: received
        pattern: .*localhost.*
    - type: Not
      criteria:
        type: HeaderPattern
        header: dkim-signature
        pattern: d=baddomain\.com
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
- name: Test domain spoofing detection
  criteria:
    type: And
    criteria:
    - type: SenderPattern
      pattern: .*@baddomain\.com$
    - type: HeaderPattern
      header: received
      pattern: .*googleusercontent\.com.*
  action:
    type: TagAsSpam
    header_name: X-Spam-Flag
    header_value: 'YES'
